<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ËãπÊûúÂ§áÂøòÂΩïÈ£éÊ†º - Â∞èÁ∫¢‰π¶Á¨îËÆ∞ÁîüÊàêÂô®</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;600;700&display=swap');
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'PingFang SC', 'Noto Sans SC', 'Helvetica Neue', sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      min-height: 100vh;
      padding: 30px;
      display: flex;
      gap: 40px;
    }
    
    /* ========== Â∑¶‰æßÊéßÂà∂Èù¢Êùø ========== */
    .controls {
      width: 380px;
      flex-shrink: 0;
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 24px;
      color: #fff;
      height: fit-content;
      max-height: calc(100vh - 60px);
      overflow-y: auto;
      position: sticky;
      top: 30px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .controls::-webkit-scrollbar {
      width: 6px;
    }
    .controls::-webkit-scrollbar-track {
      background: transparent;
    }
    .controls::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.2);
      border-radius: 3px;
    }
    
    .controls-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
    }
    
    .controls h2 {
      font-size: 20px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .quick-actions {
      display: flex;
      gap: 4px;
    }
    .quick-action {
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.08);
      border-radius: 8px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
    }
    .quick-action:hover {
      background: rgba(245, 166, 35, 0.3);
      transform: scale(1.1);
    }
    
    .btn-row {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }
    .btn-row .btn {
      flex: 1;
      margin-top: 0;
    }
    
    /* ‰∏ªÈ¢òÂàáÊç¢Âô® - ÊîæÂú®È¢ÑËßàÂå∫‰∏äÊñπ */
    .theme-switcher {
      display: flex;
      gap: 6px;
      margin-bottom: 12px;
      padding: 5px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 10px;
      width: fit-content;
    }
    .theme-btn {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 16px;
      border: none;
      background: transparent;
      color: rgba(255, 255, 255, 0.6);
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 13px;
      font-weight: 500;
    }
    .theme-btn:hover {
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
    }
    .theme-btn.active {
      background: linear-gradient(135deg, #f5a623 0%, #e8941f 100%);
      color: #fff;
    }
    .theme-btn .theme-icon { font-size: 16px; }
    
    .control-group {
      margin-bottom: 20px;
      position: relative;
    }
    
    .control-group label {
      display: block;
      font-size: 13px;
      color: rgba(255, 255, 255, 0.7);
      margin-bottom: 8px;
      font-weight: 500;
    }
    
    .control-group input,
    .control-group textarea,
    .control-group select {
      width: 100%;
      padding: 14px 16px;
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 12px;
      background: rgba(0, 0, 0, 0.3);
      color: #fff;
      font-size: 14px;
      font-family: inherit;
      transition: all 0.3s;
    }
    
    .control-group textarea {
      min-height: 280px;
      resize: vertical;
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    
    .control-group textarea.drag-over {
      border-color: #f5a623;
      box-shadow: 0 0 0 3px rgba(245, 166, 35, 0.2);
      background: rgba(245, 166, 35, 0.05);
      line-height: 1.8;
    }
    
    .control-group input:focus,
    .control-group textarea:focus,
    .control-group select:focus {
      outline: none;
      border-color: #f5a623;
      box-shadow: 0 0 0 3px rgba(245, 166, 35, 0.15);
    }
    
    .btn {
      width: 100%;
      padding: 16px;
      border: none;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 10px;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #f5a623 0%, #f7931e 100%);
      color: #fff;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(245, 166, 35, 0.3);
    }
    
    .btn-secondary {
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
      border: 1px solid rgba(255, 255, 255, 0.15);
    }
    
    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.15);
    }
    
    .btn-small {
      width: auto;
      padding: 8px 16px;
      font-size: 13px;
      margin-top: 0;
    }
    
    .page-info {
      text-align: center;
      margin-top: 20px;
      padding: 15px;
      background: rgba(245, 166, 35, 0.1);
      border-radius: 12px;
      color: #f5a623;
      font-size: 14px;
    }
    
    .tips {
      margin-top: 15px;
      padding: 16px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      font-size: 12px;
      color: rgba(255, 255, 255, 0.5);
      line-height: 1.8;
    }
    
    .tips strong {
      color: #f5a623;
    }
    
    /* ‰øùÂ≠òÂΩìÂâçÂÜÖÂÆπÊåâÈíÆ */
    .save-topic-btn {
      position: absolute;
      top: 0;
      right: 0;
      padding: 6px 12px;
      font-size: 12px;
      background: rgba(245, 166, 35, 0.2);
      border: 1px solid rgba(245, 166, 35, 0.3);
      color: #f5a623;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .save-topic-btn:hover {
      background: rgba(245, 166, 35, 0.3);
    }
    
    /* ========== Âè≥‰æßÈ¢ÑËßàÂå∫ ========== */
    .preview-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .preview-area .theme-switcher {
      margin-bottom: 15px;
    }
    
    .preview-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      max-width: 540px;
      margin-bottom: 15px;
    }
    
    .preview-title {
      color: rgba(255, 255, 255, 0.5);
      font-size: 13px;
    }
    
    .page-nav {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .page-nav button {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border: 1px solid rgba(255, 255, 255, 0.2);
      background: rgba(255, 255, 255, 0.05);
      color: #fff;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }
    
    .page-nav button:hover:not(:disabled) {
      background: rgba(255, 255, 255, 0.15);
      border-color: rgba(255, 255, 255, 0.3);
    }
    
    .page-nav button:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }
    
    .page-nav .page-num {
      color: #fff;
      font-size: 14px;
      min-width: 60px;
      text-align: center;
    }
    
    /* ========== Â§áÂøòÂΩïÊ†∑Âºè ========== */
    .memo-page {
      width: 540px;
      height: 720px;
      border-radius: 4px;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      position: relative;
      background: 
        url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E"),
        linear-gradient(180deg, #fefefe 0%, #fafafa 100%);
      background-blend-mode: overlay;
      background-size: 100px 100px, 100% 100%;
    }
    
    .memo-page::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(255, 255, 255, 0.92);
      pointer-events: none;
    }
    
    .memo-inner {
      height: 100%;
      position: relative;
      z-index: 1;
      padding: 35px 35px;
      display: flex;
      flex-direction: column;
    }
    
    .memo-title {
      font-size: 32px;
      font-weight: 700;
      color: #d4830d;
      line-height: 1.3;
      margin-bottom: 15px;
      letter-spacing: -0.5px;
    }
    
    .memo-subtitle {
      font-size: 15px;
      color: #666;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .memo-subtitle .tag {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
      background: #f5a623;
      color: #fff;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 600;
    }
    
    .memo-body { flex: 1; overflow: hidden; }
    
    .memo-content {
      font-size: 17px;
      line-height: 1.65;
      color: #1a1a1a;
      white-space: pre-wrap;
      word-break: break-word;
      letter-spacing: 0.2px;
    }
    
    .memo-content .bold { font-weight: 600; color: #000; }
    .memo-content .highlight {
      background: linear-gradient(180deg, transparent 60%, rgba(245, 166, 35, 0.35) 60%);
      padding: 0 2px;
    }
    
    /* ÁªìÊûÑÂåñÊ†ºÂºèÊ†∑Âºè */
    .memo-content .text-line {
      margin-bottom: 3px;
    }
    .memo-content .text-line:empty {
      height: 8px;
    }
    
    .memo-content .section-title {
      background: linear-gradient(135deg, #f5a623 0%, #e8941f 100%);
      color: #fff;
      padding: 6px 12px;
      border-radius: 6px;
      font-weight: 600;
      margin: 12px 0 6px 0;
      font-size: 15px;
      display: inline-block;
    }
    .memo-content .section-title:first-child {
      margin-top: 0;
    }
    .memo-content .section-label {
      background: rgba(255,255,255,0.25);
      padding: 2px 8px;
      border-radius: 4px;
      margin-right: 8px;
      font-size: 13px;
    }
    
    .memo-content .list-item {
      display: flex;
      align-items: flex-start;
      margin-bottom: 3px;
      padding-left: 4px;
    }
    .memo-content .list-dot {
      color: #f5a623;
      font-weight: bold;
      margin-right: 8px;
      flex-shrink: 0;
    }
    
    .memo-content .step-item {
      display: flex;
      align-items: flex-start;
      margin-bottom: 4px;
      padding: 3px 0;
    }
    .memo-content .step-num {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 20px;
      height: 20px;
      background: #f5a623;
      color: #fff;
      border-radius: 50%;
      font-size: 12px;
      font-weight: 600;
      margin-right: 8px;
      flex-shrink: 0;
    }
    
    .memo-content .quote-text {
      background: rgba(245, 166, 35, 0.12);
      color: #d4830d;
      padding: 1px 6px;
      border-radius: 4px;
      font-weight: 500;
    }
    
    .memo-content .arrow {
      color: #f5a623;
      font-weight: bold;
      padding: 0 2px;
    }
    
    .memo-content .label {
      color: #888;
      font-weight: 500;
    }
    
    /* Êñ∞Â¢ûÊ†ºÂºèÊ†∑Âºè */
    .memo-content .list-item.accent .list-dot { color: #e74c3c; }
    .memo-content .list-item.check .list-dot { color: #27ae60; font-size: 15px; }
    .memo-content .list-item.cross .list-dot { color: #e74c3c; font-size: 15px; }
    
    .memo-content .icon-line {
      margin-bottom: 4px;
      font-size: 16px;
    }
    
    .memo-content .divider {
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(245, 166, 35, 0.5), transparent);
      margin: 10px 0;
    }
    
    .memo-content .quote-block {
      border-left: 3px solid #f5a623;
      padding: 6px 12px;
      margin: 6px 0;
      background: rgba(245, 166, 35, 0.08);
      color: #666;
      font-style: italic;
    }
    
    .memo-content .strikethrough {
      text-decoration: line-through;
      color: #999;
    }
    
    .memo-content .code-inline {
      background: #f0f0f0;
      padding: 1px 6px;
      border-radius: 3px;
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 0.9em;
      color: #e74c3c;
    }
    
    .memo-content .emphasis-box {
      background: linear-gradient(135deg, #f5a623, #e8941f);
      color: #fff;
      padding: 2px 8px;
      border-radius: 4px;
      font-weight: 600;
    }
    
    /* Ë°®Ê†ºÊ†∑Âºè */
    .memo-content .table-wrapper {
      margin: 8px 0;
      overflow: hidden;
      border-radius: 8px;
      border: 1px solid rgba(245, 166, 35, 0.3);
    }
    
    .memo-content .memo-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }
    
    .memo-content .memo-table th {
      background: linear-gradient(135deg, #f5a623 0%, #e8941f 100%);
      color: #fff;
      padding: 8px 10px;
      text-align: left;
      font-weight: 600;
      font-size: 13px;
    }
    
    .memo-content .memo-table td {
      padding: 6px 10px;
      border-bottom: 1px solid rgba(245, 166, 35, 0.15);
    }
    
    .memo-content .memo-table tr.odd { background: #fff; }
    .memo-content .memo-table tr.even { background: rgba(245, 166, 35, 0.05); }
    .memo-content .memo-table tr:last-child td { border-bottom: none; }
    
    /* ÂõæÁâáÊ†∑Âºè */
    .memo-content .image-container {
      margin: 10px 0;
    }
    .memo-content .image-container.align-left { text-align: left; }
    .memo-content .image-container.align-center { text-align: center; }
    .memo-content .image-container.align-right { text-align: right; }
    
    .memo-content .memo-image {
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      object-fit: contain;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .memo-content .memo-image:hover {
      transform: scale(1.02);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    
    /* ÂõæÁâáÂ∞∫ÂØ∏ */
    .memo-content .memo-image.size-small { max-width: 30%; max-height: 120px; }
    .memo-content .memo-image.size-medium { max-width: 50%; max-height: 180px; }
    .memo-content .memo-image.size-large { max-width: 75%; max-height: 240px; }
    .memo-content .memo-image.size-full { max-width: 100%; max-height: 300px; }
    
    .page-indicator {
      position: absolute;
      bottom: 25px;
      right: 40px;
      font-size: 13px;
      color: #999;
    }
    
    .memo-inner.no-title { padding-top: 25px; }
    
    /* ========== Áü•‰πéÈ£éÊ†º ========== */
    .theme-zhihu .memo-page {
      background: #fff;
      border-left: 4px solid #0066ff;
    }
    .theme-zhihu .memo-page::before {
      background: transparent;
    }
    .theme-zhihu .memo-title {
      color: #1a1a1a;
      font-size: 28px;
      font-weight: 700;
      line-height: 1.4;
      margin-bottom: 16px;
      padding-bottom: 16px;
      border-bottom: 1px solid #f0f0f0;
    }
    .theme-zhihu .memo-subtitle {
      color: #0066ff;
      font-size: 14px;
      margin-bottom: 16px;
    }
    .theme-zhihu .memo-subtitle .tag {
      background: #0066ff;
      border-radius: 4px;
    }
    .theme-zhihu .memo-content {
      color: #333;
      font-size: 16px;
      line-height: 1.8;
    }
    .theme-zhihu .memo-content .bold { color: #1a1a1a; }
    .theme-zhihu .memo-content .highlight {
      background: linear-gradient(180deg, transparent 60%, rgba(0, 102, 255, 0.2) 60%);
    }
    .theme-zhihu .memo-content .section-title {
      background: linear-gradient(135deg, #0066ff 0%, #0052cc 100%);
      margin: 20px 0 12px 0;
    }
    .theme-zhihu .memo-content .list-dot { color: #0066ff; }
    .theme-zhihu .memo-content .step-num { background: #0066ff; }
    .theme-zhihu .memo-content .quote-text {
      background: rgba(0, 102, 255, 0.1);
      color: #0066ff;
    }
    .theme-zhihu .memo-content .quote-block {
      border-left-color: #0066ff;
      background: rgba(0, 102, 255, 0.05);
    }
    .theme-zhihu .memo-content .emphasis-box {
      background: linear-gradient(135deg, #0066ff, #0052cc);
    }
    .theme-zhihu .memo-content .arrow { color: #0066ff; }
    .theme-zhihu .memo-content .memo-table th {
      background: linear-gradient(135deg, #0066ff 0%, #0052cc 100%);
    }
    .theme-zhihu .memo-content .table-wrapper {
      border-color: rgba(0, 102, 255, 0.3);
    }
    .theme-zhihu .memo-content .memo-table td {
      border-bottom-color: rgba(0, 102, 255, 0.1);
    }
    .theme-zhihu .memo-content .memo-table tr.even {
      background: rgba(0, 102, 255, 0.03);
    }
    .theme-zhihu .page-indicator { color: #999; }
    
    /* ========== ÊöóÈªëÈ£éÊ†º ========== */
    .theme-dark .memo-page {
      background: linear-gradient(180deg, #1a1a2e 0%, #16213e 100%);
    }
    .theme-dark .memo-page::before {
      background: transparent;
    }
    .theme-dark .memo-title {
      color: #00d4ff;
      font-size: 30px;
      text-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
    }
    .theme-dark .memo-subtitle { color: rgba(255, 255, 255, 0.6); }
    .theme-dark .memo-subtitle .tag {
      background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
    }
    .theme-dark .memo-content {
      color: rgba(255, 255, 255, 0.85);
    }
    .theme-dark .memo-content .bold { color: #fff; }
    .theme-dark .memo-content .highlight {
      background: linear-gradient(180deg, transparent 60%, rgba(0, 212, 255, 0.3) 60%);
    }
    .theme-dark .memo-content .section-title {
      background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
      color: #1a1a2e;
    }
    .theme-dark .memo-content .text-line { color: rgba(255, 255, 255, 0.85); }
    .theme-dark .memo-content .list-dot { color: #00d4ff; }
    .theme-dark .memo-content .step-num {
      background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
      color: #1a1a2e;
    }
    .theme-dark .memo-content .quote-text {
      background: rgba(0, 212, 255, 0.15);
      color: #00d4ff;
    }
    .theme-dark .memo-content .quote-block {
      border-left-color: #00d4ff;
      background: rgba(0, 212, 255, 0.1);
      color: rgba(255, 255, 255, 0.7);
    }
    .theme-dark .memo-content .emphasis-box {
      background: linear-gradient(135deg, #00d4ff, #0099cc);
      color: #1a1a2e;
    }
    .theme-dark .memo-content .arrow { color: #00d4ff; }
    .theme-dark .memo-content .label { color: rgba(255, 255, 255, 0.5); }
    .theme-dark .memo-content .divider {
      background: linear-gradient(90deg, transparent, rgba(0, 212, 255, 0.5), transparent);
    }
    .theme-dark .memo-content .code-inline {
      background: rgba(0, 212, 255, 0.15);
      color: #00d4ff;
    }
    .theme-dark .memo-content .memo-table th {
      background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
      color: #1a1a2e;
    }
    .theme-dark .memo-content .table-wrapper {
      border-color: rgba(0, 212, 255, 0.3);
    }
    .theme-dark .memo-content .memo-table td {
      border-bottom-color: rgba(0, 212, 255, 0.15);
      color: rgba(255, 255, 255, 0.85);
    }
    .theme-dark .memo-content .memo-table tr.odd { background: rgba(0, 0, 0, 0.2); }
    .theme-dark .memo-content .memo-table tr.even { background: rgba(0, 212, 255, 0.05); }
    .theme-dark .page-indicator { color: rgba(255, 255, 255, 0.4); }
    
    /* ========== ÂØºÂá∫ÂÆπÂô® ========== */
    .export-container { position: fixed; left: -9999px; top: 0; }
    .export-container .memo-page { width: 1080px; height: 1440px; border-radius: 0; }
    .export-container .memo-inner { padding: 70px 70px; }
    .export-container .memo-title { font-size: 64px; margin-bottom: 30px; }
    .export-container .memo-subtitle { font-size: 30px; margin-bottom: 24px; gap: 16px; }
    .export-container .memo-subtitle .tag { width: 44px; height: 44px; border-radius: 10px; font-size: 24px; }
    .export-container .memo-content { font-size: 34px; line-height: 1.65; }
    .export-container .page-indicator { bottom: 40px; right: 70px; font-size: 24px; }
    .export-container .memo-inner.no-title { padding-top: 50px; }
    /* ÂØºÂá∫Êó∂ÁöÑÁªìÊûÑÂåñÊ†∑Âºè */
    .export-container .memo-content .section-title { font-size: 30px; padding: 12px 24px; border-radius: 12px; margin: 24px 0 12px 0; }
    .export-container .memo-content .section-label { padding: 4px 14px; border-radius: 6px; font-size: 24px; margin-right: 14px; }
    .export-container .memo-content .text-line { margin-bottom: 6px; }
    .export-container .memo-content .list-item { margin-bottom: 6px; padding-left: 8px; }
    .export-container .memo-content .list-dot { margin-right: 14px; font-size: 34px; }
    .export-container .memo-content .step-item { margin-bottom: 8px; padding: 6px 0; }
    .export-container .memo-content .step-num { width: 40px; height: 40px; font-size: 24px; margin-right: 16px; }
    .export-container .memo-content .quote-text { padding: 2px 10px; border-radius: 6px; }
    .export-container .memo-content .arrow { padding: 0 4px; }
    /* ÂØºÂá∫Êó∂Ë°®Ê†ºÊ†∑Âºè */
    .export-container .memo-content .table-wrapper { margin: 16px 0; border-radius: 16px; border-width: 2px; }
    .export-container .memo-content .memo-table { font-size: 28px; }
    .export-container .memo-content .memo-table th { padding: 16px 20px; font-size: 26px; }
    .export-container .memo-content .memo-table td { padding: 12px 20px; }
    /* ÂØºÂá∫Êó∂ÂÖ∂‰ªñÊñ∞Ê†∑Âºè */
    .export-container .memo-content .divider { margin: 20px 0; height: 2px; }
    .export-container .memo-content .quote-block { padding: 12px 24px; margin: 12px 0; border-left-width: 6px; }
    .export-container .memo-content .code-inline { padding: 2px 12px; font-size: 28px; }
    .export-container .memo-content .emphasis-box { padding: 4px 16px; border-radius: 8px; }
    .export-container .memo-content .icon-line { font-size: 32px; margin-bottom: 8px; }
    /* ÂØºÂá∫Êó∂ÂõæÁâáÊ†∑Âºè */
    .export-container .memo-content .image-container { margin: 20px 0; }
    .export-container .memo-content .memo-image { border-radius: 16px; cursor: default; }
    .export-container .memo-content .memo-image.size-small { max-width: 30%; max-height: 240px; }
    .export-container .memo-content .memo-image.size-medium { max-width: 50%; max-height: 360px; }
    .export-container .memo-content .memo-image.size-large { max-width: 75%; max-height: 480px; }
    .export-container .memo-content .memo-image.size-full { max-width: 100%; max-height: 600px; }
    
    /* ========== ‰æßËæπÊ†è ========== */
    .sidebar-toggle {
      position: fixed;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 40px;
      height: 100px;
      background: linear-gradient(135deg, #f5a623 0%, #f7931e 100%);
      border: none;
      border-radius: 0 12px 12px 0;
      color: #fff;
      font-size: 18px;
      cursor: pointer;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 5px;
      transition: all 0.3s;
      box-shadow: 2px 0 15px rgba(245, 166, 35, 0.3);
    }
    
    .sidebar-toggle:hover { width: 50px; }
    .sidebar-toggle span { writing-mode: vertical-rl; font-size: 13px; font-weight: 600; }
    
    .sidebar-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1001;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }
    .sidebar-overlay.show { opacity: 1; pointer-events: auto; }
    
    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      width: 420px;
      height: 100vh;
      background: #1a1a2e;
      z-index: 1002;
      transform: translateX(-100%);
      transition: transform 0.3s ease;
      display: flex;
      flex-direction: column;
      box-shadow: 5px 0 30px rgba(0, 0, 0, 0.5);
    }
    .sidebar.show { transform: translateX(0); }
    
    .sidebar-header {
      padding: 20px 25px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .sidebar-header h3 { color: #fff; font-size: 18px; display: flex; align-items: center; gap: 10px; }
    .sidebar-header .close-btn {
      width: 32px; height: 32px;
      border: none;
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
      border-radius: 8px;
      cursor: pointer;
      font-size: 18px;
    }
    
    /* ‰æßËæπÊ†èÊ†áÁ≠æÈ°µ */
    .sidebar-tabs {
      display: flex;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    .sidebar-tab {
      flex: 1;
      padding: 14px;
      background: transparent;
      border: none;
      color: rgba(255, 255, 255, 0.5);
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
    }
    .sidebar-tab:hover { color: rgba(255, 255, 255, 0.8); }
    .sidebar-tab.active { color: #f5a623; }
    .sidebar-tab.active::after {
      content: '';
      position: absolute;
      bottom: 0; left: 20%; right: 20%;
      height: 2px;
      background: #f5a623;
      border-radius: 1px;
    }
    
    .sidebar-actions {
      padding: 15px 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    .sidebar-actions .btn { margin-top: 0; padding: 12px; }
    
    .sidebar-body {
      flex: 1;
      overflow-y: auto;
      padding: 15px 20px;
    }
    .sidebar-body::-webkit-scrollbar { width: 6px; }
    .sidebar-body::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.05); }
    .sidebar-body::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.2); border-radius: 3px; }
    
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    
    /* Â§á‰ªΩÂå∫Âüü */
    .sidebar-footer {
      padding: 15px 20px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      background: rgba(0, 0, 0, 0.2);
    }
    .backup-status {
      font-size: 11px;
      color: rgba(255, 255, 255, 0.4);
      margin-bottom: 10px;
      text-align: center;
    }
    .backup-actions {
      display: flex;
      gap: 10px;
    }
    .backup-btn {
      flex: 1;
      padding: 10px;
      border: 1px solid rgba(255, 255, 255, 0.15);
      background: rgba(255, 255, 255, 0.05);
      color: rgba(255, 255, 255, 0.8);
      border-radius: 8px;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .backup-btn:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 255, 255, 0.25);
    }
    .backup-btn-primary {
      background: linear-gradient(135deg, #f5a623 0%, #f7931e 100%);
      border-color: #f5a623;
      color: #fff;
      font-weight: 600;
    }
    .backup-btn-primary:hover {
      background: linear-gradient(135deg, #f7931e 0%, #e8850a 100%);
      border-color: #e8850a;
    }
    
    /* ÈÄâÈ¢òÂç°Áâá */
    .topic-card {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 14px;
      margin-bottom: 10px;
      transition: all 0.2s;
    }
    .topic-card:hover {
      background: rgba(255, 255, 255, 0.08);
      border-color: rgba(245, 166, 35, 0.3);
    }
    
    .topic-card-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 6px;
    }
    .topic-card-title {
      flex: 1;
      font-size: 14px;
      font-weight: 600;
      color: #fff;
      line-height: 1.4;
      cursor: pointer;
    }
    .topic-card-title:hover { color: #f5a623; }
    
    /* ÂøÉÂæóÂç°ÁâáÊ†∑Âºè */
    .note-card { padding-left: 16px; }
    .note-type-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 3px 10px;
      border-radius: 12px;
      font-size: 12px;
      color: #fff;
      font-weight: 500;
    }
    .note-card-content {
      font-size: 13px;
      color: rgba(255, 255, 255, 0.8);
      line-height: 1.6;
      margin: 8px 0;
      white-space: pre-wrap;
      word-break: break-word;
    }
    
    .topic-card-actions { display: flex; gap: 5px; }
    .topic-card-actions button {
      width: 26px; height: 26px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }
    .topic-card-actions .use-btn { background: rgba(76, 175, 80, 0.2); color: #81c784; }
    .topic-card-actions .use-btn:hover { background: rgba(76, 175, 80, 0.4); }
    .topic-card-actions .archive-btn { background: rgba(33, 150, 243, 0.2); color: #64b5f6; }
    .topic-card-actions .archive-btn:hover { background: rgba(33, 150, 243, 0.4); }
    .topic-card-actions .delete-btn { background: rgba(244, 67, 54, 0.2); color: #f44336; }
    .topic-card-actions .delete-btn:hover { background: rgba(244, 67, 54, 0.4); }
    
    .topic-card-content {
      font-size: 12px;
      color: rgba(255, 255, 255, 0.4);
      line-height: 1.5;
      max-height: 40px;
      overflow: hidden;
    }
    
    .topic-card-meta {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 8px;
      padding-top: 8px;
      border-top: 1px solid rgba(255, 255, 255, 0.05);
    }
    .topic-card-date { font-size: 11px; color: rgba(255, 255, 255, 0.3); }
    
    .topic-empty {
      text-align: center;
      padding: 30px 20px;
      color: rgba(255, 255, 255, 0.3);
    }
    .topic-empty-icon { font-size: 40px; margin-bottom: 10px; }
    .topic-empty-text { font-size: 13px; }
    
    /* ========== ÂºπÁ™óÈÄöÁî®Ê†∑Âºè ========== */
    .modal-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      z-index: 2000;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }
    .modal-overlay.show { opacity: 1; pointer-events: auto; }
    
    .modal {
      width: 500px;
      max-height: 80vh;
      background: #1a1a2e;
      border-radius: 20px;
      overflow: hidden;
      transform: scale(0.9);
      transition: transform 0.3s;
      display: flex;
      flex-direction: column;
    }
    .modal-overlay.show .modal { transform: scale(1); }
    
    .modal-header {
      padding: 18px 25px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .modal-header h4 { color: #fff; font-size: 17px; }
    .modal-header .close-btn {
      width: 30px; height: 30px;
      border: none;
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
    }
    
    .modal-body {
      padding: 20px 25px;
      overflow-y: auto;
      flex: 1;
    }
    .modal-body .control-group { margin-bottom: 15px; }
    .modal-body .control-group:last-child { margin-bottom: 0; }
    .modal-body textarea { min-height: 120px; }
    .modal-body select {
      width: 100%;
      padding: 10px 15px;
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.08);
      color: #fff;
      font-size: 14px;
      cursor: pointer;
    }
    .modal-body select option {
      background: #1a1a2e;
      color: #fff;
    }
    
    .modal-footer {
      padding: 15px 25px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      gap: 10px;
      justify-content: flex-end;
    }
    .modal-footer .btn { width: auto; padding: 10px 20px; margin-top: 0; font-size: 14px; }
    .modal-footer .btn-danger {
      background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
      border-color: #c0392b;
    }
    .modal-footer .btn-danger:hover {
      background: linear-gradient(135deg, #c0392b 0%, #a93226 100%);
    }
    
    /* ========== ÂõæÁâáÁºñËæëÂºπÁ™ó ========== */
    .image-editor { width: 500px; }
    
    .img-preview-box {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      margin-bottom: 20px;
    }
    .img-preview-box img {
      max-width: 100%;
      max-height: 200px;
      border-radius: 8px;
      object-fit: contain;
    }
    
    .img-settings .control-group { margin-bottom: 18px; }
    .img-settings .control-group label {
      display: block;
      margin-bottom: 10px;
      font-size: 14px;
      color: #aaa;
    }
    
    .btn-group {
      display: flex;
      gap: 8px;
    }
    .align-btn {
      flex: 1;
      padding: 10px;
      border: 1px solid rgba(255, 255, 255, 0.15);
      background: rgba(255, 255, 255, 0.05);
      color: #aaa;
      border-radius: 8px;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.2s;
    }
    .align-btn:hover {
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
    }
    .align-btn.active {
      background: linear-gradient(135deg, #f5a623 0%, #e8941f 100%);
      border-color: #f5a623;
      color: #fff;
    }
    
    .size-options {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
    }
    .size-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      padding: 12px 8px;
      border: 1px solid rgba(255, 255, 255, 0.15);
      background: rgba(255, 255, 255, 0.05);
      color: #aaa;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .size-btn:hover {
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
    }
    .size-btn.active {
      background: linear-gradient(135deg, #f5a623 0%, #e8941f 100%);
      border-color: #f5a623;
      color: #fff;
    }
    .size-btn .size-icon { font-size: 20px; }
    .size-btn span:nth-child(2) { font-size: 13px; font-weight: 500; }
    .size-btn .size-hint { font-size: 11px; opacity: 0.7; }
    
    /* ========== Ê†áÁ≠æËØçÂ∫ìÂºπÁ™ó ========== */
    .tags-modal .modal { width: 600px; }
    
    .tag-category {
      margin-bottom: 20px;
    }
    .tag-category:last-child { margin-bottom: 0; }
    
    .tag-category-title {
      font-size: 14px;
      font-weight: 600;
      color: #f5a623;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .tag-list {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    
    .tag-item {
      padding: 6px 12px;
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 16px;
      color: rgba(255, 255, 255, 0.8);
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .tag-item:hover {
      background: rgba(245, 166, 35, 0.2);
      border-color: rgba(245, 166, 35, 0.4);
      color: #f5a623;
    }
    .tag-item.selected {
      background: rgba(245, 166, 35, 0.3);
      border-color: #f5a623;
      color: #f5a623;
    }
    
    .selected-tags {
      margin-top: 20px;
      padding: 15px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 12px;
    }
    .selected-tags-title {
      font-size: 13px;
      color: rgba(255, 255, 255, 0.5);
      margin-bottom: 10px;
    }
    .selected-tags-content {
      font-size: 14px;
      color: #fff;
      line-height: 1.6;
      word-break: break-all;
      min-height: 20px;
    }
    .selected-tags-content:empty::before {
      content: 'ÁÇπÂáª‰∏äÊñπÊ†áÁ≠æÊ∑ªÂä†...';
      color: rgba(255, 255, 255, 0.3);
    }
    
    /* Êé®ÊµÅÊú∫Âà∂ÂºπÁ™ó */
    .flow-modal-content {
      max-width: 600px;
    }
    .flow-body {
      max-height: 65vh;
      overflow-y: auto;
    }
    .flow-section {
      margin-bottom: 24px;
    }
    .flow-section:last-child {
      margin-bottom: 0;
    }
    .flow-section-title {
      font-size: 15px;
      font-weight: 600;
      color: #f5a623;
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 1px solid rgba(245, 166, 35, 0.2);
    }
    
    .flow-timeline {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .flow-item {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
      padding: 12px 15px;
      border-left: 3px solid #f5a623;
    }
    .flow-time {
      font-size: 14px;
      font-weight: 600;
      color: #fff;
      margin-bottom: 4px;
    }
    .flow-desc {
      font-size: 13px;
      color: rgba(255, 255, 255, 0.7);
      margin-bottom: 6px;
    }
    .flow-tip {
      font-size: 12px;
      color: #f5a623;
    }
    
    .flow-levels {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }
    .flow-level {
      padding: 10px 12px;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.05);
    }
    .level-range {
      font-size: 13px;
      font-weight: 600;
      color: #fff;
      margin-bottom: 4px;
    }
    .level-issue {
      font-size: 12px;
      color: rgba(255, 255, 255, 0.6);
    }
    .flow-level.level-1 { border-left: 3px solid #ff6b6b; }
    .flow-level.level-2 { border-left: 3px solid #ffa94d; }
    .flow-level.level-3 { border-left: 3px solid #ffd43b; }
    .flow-level.level-4 { border-left: 3px solid #69db7c; }
    .flow-level.level-5 { border-left: 3px solid #4dabf7; }
    .flow-level.level-6 { border-left: 3px solid #da77f2; }
    
    .ces-formula {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      flex-wrap: wrap;
      padding: 15px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
      margin-bottom: 10px;
    }
    .ces-item {
      padding: 6px 12px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 6px;
      font-size: 13px;
      color: rgba(255, 255, 255, 0.8);
    }
    .ces-item.highlight {
      background: rgba(245, 166, 35, 0.2);
      color: #f5a623;
      font-weight: 600;
    }
    .ces-plus {
      color: rgba(255, 255, 255, 0.4);
      font-size: 16px;
    }
    .ces-tip {
      font-size: 12px;
      color: rgba(255, 255, 255, 0.5);
      text-align: center;
    }
    
    .checklist {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .check-item {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 13px;
      color: rgba(255, 255, 255, 0.8);
      cursor: pointer;
      padding: 8px 12px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      transition: background 0.2s;
    }
    .check-item:hover {
      background: rgba(255, 255, 255, 0.1);
    }
    .check-item input[type="checkbox"] {
      width: 18px;
      height: 18px;
      accent-color: #f5a623;
    }
    
    /* Âä†ËΩΩÊèêÁ§∫ */
    .loading-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.85);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }
    .loading-overlay.show { opacity: 1; pointer-events: auto; }
    
    .loading-spinner {
      width: 50px; height: 50px;
      border: 3px solid rgba(245, 166, 35, 0.2);
      border-top-color: #f5a623;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .loading-text { color: #fff; margin-top: 20px; font-size: 14px; }
    
    /* Â§çÂà∂ÊàêÂäüÊèêÁ§∫ */
    .toast {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: rgba(76, 175, 80, 0.95);
      color: #fff;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 14px;
      z-index: 9999;
      transition: transform 0.3s;
    }
    .toast.show { transform: translateX(-50%) translateY(0); }
    
    /* ========== ÂìçÂ∫îÂºèÈÄÇÈÖç - Âπ≥Êùø ========== */
    @media screen and (max-width: 1024px) {
      body {
        padding: 20px;
        gap: 25px;
      }
      
      .controls {
        width: 320px;
      }
      
      .memo-page {
        width: 480px;
        height: 640px;
      }
      
      .memo-inner {
        padding: 28px;
      }
      
      .memo-title {
        font-size: 26px;
      }
      
      .memo-content {
        font-size: 15px;
      }
    }
    
    /* ========== ÂìçÂ∫îÂºèÈÄÇÈÖç - ÊâãÊú∫ ========== */
    @media screen and (max-width: 768px) {
      body {
        flex-direction: column;
        padding: 15px;
        gap: 20px;
        min-height: auto;
      }
      
      /* ÊéßÂà∂Èù¢ÊùøÂÖ®ÂÆΩ */
      .controls {
        width: 100%;
        position: relative;
        top: 0;
        max-height: none;
        order: 1;
      }
      
      .control-group textarea {
        min-height: 200px;
      }
      
      /* È¢ÑËßàÂå∫Âüü */
      .preview-area {
        width: 100%;
        order: 2;
      }
      
      /* Â§áÂøòÂΩïÈ°µÈù¢ÈÄÇÈÖç */
      .memo-page {
        width: 100%;
        max-width: 400px;
        height: auto;
        min-height: 520px;
        aspect-ratio: 3/4;
      }
      
      .memo-inner {
        padding: 24px;
      }
      
      .memo-title {
        font-size: 22px;
        margin-bottom: 10px;
      }
      
      .memo-subtitle {
        font-size: 13px;
        margin-bottom: 10px;
      }
      
      .memo-content {
        font-size: 14px;
        line-height: 1.6;
      }
      
      .memo-content .section-title {
        font-size: 13px;
        padding: 5px 10px;
      }
      
      .memo-content .step-num {
        width: 18px;
        height: 18px;
        font-size: 11px;
      }
      
      .page-indicator {
        font-size: 11px;
        bottom: 15px;
        right: 24px;
      }
      
      /* ‰æßËæπÊ†èÂÖ®Â±è */
      .sidebar {
        width: 100%;
      }
      
      .sidebar-toggle {
        width: 32px;
        height: 70px;
        font-size: 14px;
      }
      
      .sidebar-toggle span {
        font-size: 11px;
      }
      
      /* ‰∏ªÈ¢òÂàáÊç¢ */
      .theme-switcher {
        flex-wrap: wrap;
        justify-content: center;
      }
      
      .theme-btn {
        padding: 6px 12px;
        font-size: 12px;
      }
      
      /* È°µÈù¢ÂØºËà™ */
      .preview-header {
        flex-direction: column;
        gap: 10px;
        align-items: center;
      }
      
      /* ÊåâÈíÆ */
      .btn {
        padding: 14px;
        font-size: 14px;
      }
      
      .btn-row {
        flex-direction: column;
      }
      
      /* ÂºπÁ™óÈÄÇÈÖç */
      .modal {
        width: 95%;
        max-width: 400px;
        margin: 10px;
      }
      
      .quick-actions {
        gap: 2px;
      }
      
      .quick-action {
        width: 28px;
        height: 28px;
        font-size: 12px;
      }
    }
    
    /* ========== ÂìçÂ∫îÂºèÈÄÇÈÖç - Â∞èÊâãÊú∫ ========== */
    @media screen and (max-width: 480px) {
      body {
        padding: 10px;
      }
      
      .controls {
        padding: 18px;
        border-radius: 15px;
      }
      
      .controls h2 {
        font-size: 16px;
      }
      
      .memo-page {
        max-width: 340px;
        min-height: 450px;
      }
      
      .memo-inner {
        padding: 20px;
      }
      
      .memo-title {
        font-size: 18px;
      }
      
      .memo-content {
        font-size: 13px;
      }
      
      .control-group input,
      .control-group textarea {
        padding: 12px;
        font-size: 14px;
      }
      
      .tips {
        font-size: 11px;
      }
    }
  </style>
</head>
<body>
  <!-- ‰æßËæπÊ†èÂàáÊç¢ÊåâÈíÆ -->
  <button class="sidebar-toggle" onclick="toggleSidebar()">
    üìö
    <span>ÂÜÖÂÆπÂ∫ì</span>
  </button>
  
  <!-- ‰æßËæπÊ†èÈÅÆÁΩ© -->
  <div class="sidebar-overlay" id="sidebar-overlay" onclick="toggleSidebar()"></div>
  
  <!-- ‰æßËæπÊ†è -->
  <div class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <h3>üìö ÂÜÖÂÆπÁÆ°ÁêÜ</h3>
      <button class="close-btn" onclick="toggleSidebar()">√ó</button>
    </div>
    
    <!-- Ê†áÁ≠æÈ°µÂàáÊç¢ -->
    <div class="sidebar-tabs">
      <button class="sidebar-tab active" onclick="switchTab('topics')">üìù ÈÄâÈ¢ò</button>
      <button class="sidebar-tab" onclick="switchTab('notes')">üí° ÂøÉÂæó</button>
      <button class="sidebar-tab" onclick="switchTab('history')">üìú ÂéÜÂè≤</button>
    </div>
    
    <!-- ÈÄâÈ¢òÂ∫ìÂÜÖÂÆπ -->
    <div id="tab-topics" class="tab-content active">
      <div class="sidebar-actions">
        <button class="btn btn-primary" onclick="openNewTopicModal()">‚ûï Êñ∞Âª∫ÈÄâÈ¢ò</button>
      </div>
      <div class="sidebar-body" id="topic-list"></div>
    </div>
    
    <!-- ÂÜô‰ΩúÂøÉÂæóÂÜÖÂÆπ -->
    <div id="tab-notes" class="tab-content">
      <div class="sidebar-actions">
        <button class="btn btn-primary" onclick="openNewNoteModal()">‚ûï ËÆ∞ÂΩïÂøÉÂæó</button>
      </div>
      <div class="sidebar-body" id="notes-list"></div>
    </div>
    
    <!-- ÂéÜÂè≤ËÆ∞ÂΩïÂÜÖÂÆπ -->
    <div id="tab-history" class="tab-content">
      <div class="sidebar-body" id="history-list"></div>
    </div>
    
    <!-- Â§á‰ªΩÂå∫Âüü -->
    <div class="sidebar-footer">
      <div class="backup-status" id="backup-status">ÁÇπÂáª‰∏ãÊñπËÆæÁΩÆËá™Âä®‰øùÂ≠òË∑ØÂæÑ</div>
      <div class="backup-actions">
        <button class="backup-btn backup-btn-primary" onclick="setupAutoSave()" title="ËÆæÁΩÆËá™Âä®‰øùÂ≠òÊñá‰ª∂Ë∑ØÂæÑ">üìÅ ËÆæÁΩÆË∑ØÂæÑ</button>
      </div>
      <div class="backup-actions" style="margin-top: 8px;">
        <button class="backup-btn" onclick="exportBackup()" title="ÊâãÂä®ÂØºÂá∫Â§á‰ªΩ">üì§ ÂØºÂá∫</button>
        <button class="backup-btn" onclick="importBackup()" title="‰ªéÊñá‰ª∂ÊÅ¢Â§ç">üì• ÂØºÂÖ•</button>
      </div>
    </div>
  </div>
  
  <!-- Êñ∞Âª∫ÂøÉÂæóÂºπÁ™ó -->
  <div class="modal-overlay" id="note-modal">
    <div class="modal">
      <div class="modal-header">
        <h4 id="note-modal-title">üí° ËÆ∞ÂΩïÂøÉÂæó</h4>
        <button class="close-btn" onclick="closeNoteModal()">√ó</button>
      </div>
      <div class="modal-body">
        <div class="control-group">
          <label>ÂøÉÂæóÁ±ªÂûã</label>
          <select id="note-type">
            <option value="success">‚úÖ ÊàêÂäüÁªèÈ™å</option>
            <option value="fail">‚ùå Ë∏©ÂùëÊïôËÆ≠</option>
            <option value="idea">üí° ÁÅµÊÑüÊÉ≥Ê≥ï</option>
            <option value="data">üìä Êï∞ÊçÆÂ§çÁõò</option>
          </select>
        </div>
        <div class="control-group">
          <label>ÂøÉÂæóÂÜÖÂÆπ *</label>
          <textarea id="note-content" placeholder="ËÆ∞ÂΩï‰Ω†ÁöÑËøêËê•ÂøÉÂæó„ÄÅË∏©ËøáÁöÑÂùë„ÄÅÊàêÂäüÁöÑÁªèÈ™å..."></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeNoteModal()">ÂèñÊ∂à</button>
        <button class="btn btn-primary" onclick="saveNote()">‰øùÂ≠ò</button>
      </div>
    </div>
  </div>
  
  <!-- Êñ∞Âª∫ÈÄâÈ¢òÂºπÁ™ó -->
  <div class="modal-overlay" id="topic-modal">
    <div class="modal">
      <div class="modal-header">
        <h4>üìù Êñ∞Âª∫ÈÄâÈ¢ò</h4>
        <button class="close-btn" onclick="closeTopicModal()">√ó</button>
      </div>
      <div class="modal-body">
        <div class="control-group">
          <label>ÈÄâÈ¢òÊ†áÈ¢ò *</label>
          <input type="text" id="new-topic-title" placeholder="ËæìÂÖ•ÈÄâÈ¢òÊ†áÈ¢ò">
        </div>
        <div class="control-group">
          <label>ÂÜÖÂÆπËçâÁ®øÔºàÂèØÈÄâÔºâ</label>
          <textarea id="new-topic-content" placeholder="ÂèØ‰ª•ÂÖàÂÜô‰∏Ä‰∫õÂÜÖÂÆπËçâÁ®ø"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeTopicModal()">ÂèñÊ∂à</button>
        <button class="btn btn-primary" onclick="saveTopic()">‰øùÂ≠ò</button>
      </div>
    </div>
  </div>
  
  <!-- ÂõæÁâáÁºñËæëÂºπÁ™ó -->
  <div class="modal-overlay" id="image-editor-modal">
    <div class="modal image-editor">
      <div class="modal-header">
        <h4>üñºÔ∏è ÂõæÁâáËÆæÁΩÆ</h4>
        <button class="close-btn" onclick="closeImageEditor()">√ó</button>
      </div>
      <div class="modal-body">
        <div class="img-preview-box">
          <img id="img-preview" src="" alt="È¢ÑËßà">
        </div>
        <div class="img-settings">
          <div class="control-group">
            <label>ÂØπÈΩêÊñπÂºè</label>
            <div class="btn-group">
              <button type="button" class="align-btn" data-value="left" onclick="setAlign('left')">‚¨ÖÔ∏è Â∑¶ÂØπÈΩê</button>
              <button type="button" class="align-btn active" data-value="center" onclick="setAlign('center')">‚ÜîÔ∏è Â±Ö‰∏≠</button>
              <button type="button" class="align-btn" data-value="right" onclick="setAlign('right')">‚û°Ô∏è Âè≥ÂØπÈΩê</button>
            </div>
            <select id="img-align" style="display:none">
              <option value="left">Â∑¶ÂØπÈΩê</option>
              <option value="center" selected>Â±Ö‰∏≠</option>
              <option value="right">Âè≥ÂØπÈΩê</option>
            </select>
          </div>
          <div class="control-group">
            <label>ÂõæÁâáÂ§ßÂ∞è</label>
            <div class="size-options">
              <button type="button" class="size-btn" data-value="small" onclick="setSize('small')">
                <span class="size-icon">üîπ</span>
                <span>Â∞èÂõæ</span>
                <span class="size-hint">30%</span>
              </button>
              <button type="button" class="size-btn active" data-value="medium" onclick="setSize('medium')">
                <span class="size-icon">üî∑</span>
                <span>‰∏≠Âõæ</span>
                <span class="size-hint">50%</span>
              </button>
              <button type="button" class="size-btn" data-value="large" onclick="setSize('large')">
                <span class="size-icon">üíé</span>
                <span>Â§ßÂõæ</span>
                <span class="size-hint">75%</span>
              </button>
              <button type="button" class="size-btn" data-value="full" onclick="setSize('full')">
                <span class="size-icon">üìê</span>
                <span>ÂÖ®ÂÆΩ</span>
                <span class="size-hint">100%</span>
              </button>
            </div>
            <select id="img-size" style="display:none">
              <option value="small">Â∞è (30%)</option>
              <option value="medium" selected>‰∏≠ (50%)</option>
              <option value="large">Â§ß (75%)</option>
              <option value="full">ÂÖ®ÂÆΩ (100%)</option>
            </select>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-danger" onclick="deleteImage()">üóëÔ∏è Âà†Èô§ÂõæÁâá</button>
        <button class="btn btn-primary" onclick="applyImageSettings()">‚úì Â∫îÁî®ËÆæÁΩÆ</button>
      </div>
    </div>
  </div>
  
  <!-- Ê†áÁ≠æËØçÂ∫ìÂºπÁ™ó -->
  <div class="modal-overlay tags-modal" id="tags-modal">
    <div class="modal">
      <div class="modal-header">
        <h4>üè∑Ô∏è Ê†áÁ≠æËØçÂ∫ì</h4>
        <button class="close-btn" onclick="closeTagsModal()">√ó</button>
      </div>
      <div class="modal-body" id="tags-body">
        <!-- Ê†áÁ≠æÂàÜÁ±ª‰ºöÂä®ÊÄÅÁîüÊàê -->
      </div>
      <div class="selected-tags">
        <div class="selected-tags-title">Â∑≤ÈÄâÊ†áÁ≠æÔºàÁÇπÂáªÂ§çÂà∂Ôºâ</div>
        <div class="selected-tags-content" id="selected-tags" onclick="copySelectedTags()"></div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="clearSelectedTags()">Ê∏ÖÁ©∫</button>
        <button class="btn btn-primary" onclick="copySelectedTags()">üìã Â§çÂà∂Ê†áÁ≠æ</button>
      </div>
    </div>
  </div>
  
  <!-- Êé®ÊµÅÊú∫Âà∂ÂºπÁ™ó -->
  <div class="modal-overlay flow-modal" id="flow-modal">
    <div class="modal flow-modal-content">
      <div class="modal-header">
        <h4>üìà Â∞èÁ∫¢‰π¶Êé®ÊµÅÊú∫Âà∂</h4>
        <button class="close-btn" onclick="closeFlowModal()">√ó</button>
      </div>
      <div class="modal-body flow-body">
        <div class="flow-section">
          <div class="flow-section-title">‚è∞ ÊµÅÈáèÊé®ÈÄÅÊó∂Èó¥Á∫ø</div>
          <div class="flow-timeline">
            <div class="flow-item">
              <div class="flow-time">ÂèëÂ∏ÉÂêé 2Â∞èÊó∂</div>
              <div class="flow-desc">ÂàùÂßãÊõùÂÖâÔºåÊé®ÁªôÁõÆÊ†áÁæ§‰Ωì</div>
              <div class="flow-tip">üí° ÈÄâÂØπÂèëÂ∏ÉÊó∂Èó¥Ôºö‰∏äÂçà10ÁÇπ / Êôö‰∏ä10ÁÇπ</div>
            </div>
            <div class="flow-item">
              <div class="flow-time">ÂèëÂ∏ÉÂêé 24Â∞èÊó∂</div>
              <div class="flow-desc">‰ºòË¥®Á¨îËÆ∞Âä†ÊùÉÔºàCESÁ≥ªÊï∞Ôºâ</div>
              <div class="flow-tip">üí° ÂèäÊó∂ÂõûÂ§çËØÑËÆ∫ÔºåÊèêÂçá‰∫íÂä®</div>
            </div>
            <div class="flow-item">
              <div class="flow-time">ÂèëÂ∏ÉÂêé 7Â§©</div>
              <div class="flow-desc">ÂàÜÊ∞¥Â≤≠ÔºöÊï∞ÊçÆÂ•ΩÂä†ÊùÉÔºåÂ∑ÆÂ∞±Âáâ</div>
              <div class="flow-tip">üí° ÂÖ≥ÈîÆÊúüÔºÅÊåÅÁª≠ÂÖ≥Ê≥®Êï∞ÊçÆ</div>
            </div>
            <div class="flow-item">
              <div class="flow-time">ÂèëÂ∏ÉÂêé 30Â§©</div>
              <div class="flow-desc">ÂÖ≥Èó≠Ëá™ÁÑ∂Êé®ÊµÅÔºåÂè™Ââ©ÊêúÁ¥¢Â±ïÁ§∫</div>
              <div class="flow-tip">üí° Ê†áÈ¢òË¶ÅÊúâÊêúÁ¥¢ÂÖ≥ÈîÆËØç</div>
            </div>
          </div>
        </div>
        
        <div class="flow-section">
          <div class="flow-section-title">üëÄ ÊµÅÈáèÊ±†Á≠âÁ∫ß</div>
          <div class="flow-levels">
            <div class="flow-level level-1">
              <div class="level-range">1Á∫ßÔºö0-100</div>
              <div class="level-issue">ÂèØËÉΩËøùËßÑÊàñÂÜÖÂÆπÂ§™Â∑Æ</div>
            </div>
            <div class="flow-level level-2">
              <div class="level-range">2Á∫ßÔºö200-500</div>
              <div class="level-issue">Ê†áÈ¢òÂ∞ÅÈù¢‰∏ÄËà¨ÔºåÈúÄ‰ºòÂåñ</div>
            </div>
            <div class="flow-level level-3">
              <div class="level-range">3Á∫ßÔºö3k-5k</div>
              <div class="level-issue">ÊúâÂπ≤Ë¥ß‰ΩÜ‰∫íÂä®‰∏ÄËà¨</div>
            </div>
            <div class="flow-level level-4">
              <div class="level-range">4Á∫ßÔºö1w-2w</div>
              <div class="level-issue">ÁÉ≠Èó®Â§áÈÄâÔºåËøõÂÖ•‰∫∫Â∑•ÂÆ°Ê†∏</div>
            </div>
            <div class="flow-level level-5">
              <div class="level-range">5Á∫ßÔºö10w-20w</div>
              <div class="level-issue">ÁÉ≠Èó®Á¨îËÆ∞ÔºåÂÜÖÂÆπÊúâÁ®ÄÁº∫ÊÄß</div>
            </div>
            <div class="flow-level level-6">
              <div class="level-range">6Á∫ßÔºö100w+</div>
              <div class="level-issue">Â§ßÁÉ≠Èó®ÔºåÂ§¥ÈÉ®Ëææ‰∫∫</div>
            </div>
          </div>
        </div>
        
        <div class="flow-section">
          <div class="flow-section-title">üìä CESËØÑÂàÜÂÖ¨Âºè</div>
          <div class="ces-formula">
            <span class="ces-item">ÁÇπËµû √ó1</span>
            <span class="ces-plus">+</span>
            <span class="ces-item">Êî∂Ëóè √ó1</span>
            <span class="ces-plus">+</span>
            <span class="ces-item highlight">ËØÑËÆ∫ √ó4</span>
            <span class="ces-plus">+</span>
            <span class="ces-item highlight">ËΩ¨Âèë √ó4</span>
          </div>
          <div class="ces-tip">ËØÑËÆ∫ÂíåËΩ¨ÂèëÊùÉÈáçÊúÄÈ´òÔºÅÂºïÂØºÁî®Êà∑ËØÑËÆ∫ÂæàÈáçË¶Å</div>
        </div>
        
        <div class="flow-section">
          <div class="flow-section-title">‚úÖ ÂèëÂ∏ÉÂâçÊ£ÄÊü•Ê∏ÖÂçï</div>
          <div class="checklist">
            <label class="check-item"><input type="checkbox"> Ê†áÈ¢òÊúâÊêúÁ¥¢ÂÖ≥ÈîÆËØç</label>
            <label class="check-item"><input type="checkbox"> Â∞ÅÈù¢ÂõæÊ∏ÖÊô∞ÊúâÂê∏ÂºïÂäõ</label>
            <label class="check-item"><input type="checkbox"> ÂÜÖÂÆπÊú´Â∞æÊúâ‰∫íÂä®ÂºïÂØº</label>
            <label class="check-item"><input type="checkbox"> Â∑≤Ê£ÄÊµãËøùÁ¶ÅËØç</label>
            <label class="check-item"><input type="checkbox"> ÂèëÂ∏ÉÊó∂Èó¥Ôºö‰∏äÂçà10ÁÇπ / Êôö‰∏ä10ÁÇπ</label>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" onclick="closeFlowModal()">Áü•ÈÅì‰∫Ü</button>
      </div>
    </div>
  </div>
  
  <!-- Âä†ËΩΩÊèêÁ§∫ -->
  <div class="loading-overlay" id="loading">
    <div class="loading-spinner"></div>
    <div class="loading-text">Ê≠£Âú®ÁîüÊàêÂõæÁâá...</div>
  </div>
  
  <!-- Â§çÂà∂ÊàêÂäüÊèêÁ§∫ -->
  <div class="toast" id="toast">‚úì Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø</div>

  <!-- Â∑¶‰æßÊéßÂà∂Èù¢Êùø -->
  <div class="controls">
    <div class="controls-header">
      <h2>üìù Á¨îËÆ∞ÁîüÊàêÂô®</h2>
      <div class="quick-actions">
        <a href="https://xhsplus.io/workspace#/3in1/sensitiveWords" target="_blank" class="quick-action" title="ËøùÁ¶ÅËØçÊ£ÄÊµã">üîç</a>
        <div class="quick-action" onclick="openTagsModal()" title="Ê†áÁ≠æËØçÂ∫ì">üè∑Ô∏è</div>
        <div class="quick-action" onclick="openFlowModal()" title="Êé®ÊµÅÊú∫Âà∂">üìà</div>
        <a href="https://www.xiaohongshu.com/explore" target="_blank" class="quick-action" title="Â∞èÁ∫¢‰π¶">üì±</a>
      </div>
    </div>
    
    <div class="control-group">
      <label>Ê†áÈ¢ò</label>
      <input type="text" id="memo-title" value="" placeholder="ËæìÂÖ•Á¨îËÆ∞Ê†áÈ¢ò" oninput="updatePreview()">
    </div>
    
    <div class="control-group">
      <label>ÂâØÊ†áÈ¢ò/Á≥ªÂàóÊ†áÁ≠æÔºàÂèØÈÄâÔºâ</label>
      <input type="text" id="memo-subtitle" value="" placeholder="Â¶ÇÔºöÂπ≤Ë¥ßÂàÜ‰∫´ 1" oninput="updatePreview()">
    </div>
    
    <div class="control-group">
      <label>Ê≠£ÊñáÂÜÖÂÆπÔºàÊîØÊåÅ **Âä†Á≤ó** ==È´ò‰∫Æ==Ôºâ</label>
      <button class="save-topic-btn" onclick="saveCurrentAsTopic()">üíæ Â≠ò‰∏∫ÈÄâÈ¢ò</button>
      <textarea id="memo-content" placeholder="Âú®ËøôÈáåËæìÂÖ•Ê≠£ÊñáÂÜÖÂÆπ...

ÊîØÊåÅÁöÑÊ†ºÂºèÔºö
‚Ä¢ ÂàóË°®È°π
‚ë†‚ë°‚ë¢ Â∫èÂè∑
**Âä†Á≤óÊñáÂ≠ó**
==È´ò‰∫ÆÊñáÂ≠ó==
„ÄêÂ∞èÊ†áÈ¢ò„Äë
> ÂºïÁî®Âùó

ÊãñÊãΩÊàñÁ≤òË¥¥ÂèØÊèíÂÖ•ÂõæÁâá" oninput="updatePreview()"></textarea>
    </div>
    
    <div class="page-info" id="page-info">üìÑ ÂÖ± 1 È°µ</div>
    
    <div class="btn-row">
      <button class="btn btn-primary" onclick="downloadAllPages()">üì• ‰∏ãËΩΩÂÖ®ÈÉ®</button>
      <button class="btn btn-secondary" onclick="downloadCurrentPage()">üìÑ ÂΩìÂâçÈ°µ</button>
    </div>
    
    <div class="tips">
      <strong>Ê†ºÂºèÔºö</strong> „ÄêÊ†áÈ¢ò„Äë ‚Ä¢ ÂàóË°® ‚ë†Â∫èÂè∑ **Âä†Á≤ó** ==È´ò‰∫Æ==<br>
      <strong>ÂõæÁâáÔºö</strong> ÊãñÊãΩ/Á≤òË¥¥ÊèíÂÖ•ÔºåÁÇπÂáªÁºñËæë
    </div>
  </div>
  
  <!-- Âè≥‰æßÈ¢ÑËßàÂå∫ -->
  <div class="preview-area" id="preview-container">
    <!-- ‰∏ªÈ¢òÂàáÊç¢ÊîæÂú®È¢ÑËßàÂå∫‰∏äÊñπ -->
    <div class="theme-switcher">
      <button class="theme-btn active" data-theme="memo" onclick="switchTheme('memo')">
        <span class="theme-icon">üìí</span>
        <span>Â§áÂøòÂΩï</span>
      </button>
      <button class="theme-btn" data-theme="zhihu" onclick="switchTheme('zhihu')">
        <span class="theme-icon">üí¨</span>
        <span>Áü•‰πé</span>
      </button>
      <button class="theme-btn" data-theme="dark" onclick="switchTheme('dark')">
        <span class="theme-icon">üåô</span>
        <span>ÊöóÈªë</span>
      </button>
    </div>
    
    <div class="preview-header">
      <span class="preview-title">È¢ÑËßà</span>
      <div class="page-nav">
        <button onclick="prevPage()" id="btn-prev" disabled>‚Äπ</button>
        <span class="page-num" id="page-display">1 / 1</span>
        <button onclick="nextPage()" id="btn-next" disabled>‚Ä∫</button>
      </div>
    </div>
    <div class="pages-container" id="pages-container"></div>
  </div>
  
  <div class="export-container" id="export-container"></div>
  
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
  
  <script>
    // ========== Êï∞ÊçÆÂ≠òÂÇ® ==========
    const TOPICS_KEY = 'xhs_topics_v3';
    const HISTORY_KEY = 'xhs_history_v1';
    const MAX_HISTORY = 50;
    
    // Ê†áÁ≠æËØçÂ∫ìÊï∞ÊçÆ
    const TAG_CATEGORIES = [
      {
        name: 'üéì ËÄÉÁ†î/‰øùÁ†î',
        tags: ['ËÄÉÁ†î', '‰øùÁ†î', 'ËÄÉÁ†îÂ§çËØï', '‰øùÁ†îÈù¢ËØï', 'Êé®ÂÖç', 'ËÄÉÁ†îËã±ËØ≠', 'ËÄÉÁ†îÊï∞Â≠¶', 'ËÄÉÁ†îÊîøÊ≤ª', 'Ë∑®‰∏ì‰∏öËÄÉÁ†î', '‰∫åÊàòËÄÉÁ†î', 'Ë∞ÉÂâÇ']
      },
      {
        name: 'üìö Á†îÁ©∂Áîü/ÁßëÁ†î',
        tags: ['Á†îÁ©∂Áîü', 'ËØªÁ†î', 'ÁßëÁ†î', 'Á†î‰∏Ä', 'Á†î‰∫å', 'Á†î‰∏â', 'Á°ïÂ£´', 'ÂçöÂ£´', 'ÂØºÂ∏à', 'ËÆ∫Êñá', 'ÂºÄÈ¢ò', 'ÊØï‰∏öËÆ∫Êñá', 'ÁßëÁ†îÂ∞èÁôΩ']
      },
      {
        name: 'ü§ñ AI/ÁºñÁ®ã',
        tags: ['Êú∫Âô®Â≠¶‰π†', 'Ê∑±Â∫¶Â≠¶‰π†', 'Python', '‰∫∫Â∑•Êô∫ËÉΩ', 'AI', '‰ª£Á†Å', 'ÁºñÁ®ã', 'ChatGPT', 'Â§ßÊ®°Âûã', 'PyTorch', 'Êï∞ÊçÆÂàÜÊûê', 'CV', 'NLP']
      },
      {
        name: 'üí° Âπ≤Ë¥ß/Â≠¶‰π†',
        tags: ['Âπ≤Ë¥ß', 'Âª∫ËÆÆÊî∂Ëóè', 'Â≠¶‰π†ÊñπÊ≥ï', 'ÈÅøÂùë', 'ÁªèÈ™åÂàÜ‰∫´', 'Â≠¶‰π†', 'Ëá™Âæã', 'Êó∂Èó¥ÁÆ°ÁêÜ', 'ÊïàÁéá', 'Â∑•ÂÖ∑Êé®Ëçê']
      },
      {
        name: 'üòÑ Êó•Â∏∏/ÊÉÖÊÑü',
        tags: ['Á†îÁ©∂ÁîüÊó•Â∏∏', 'ÁßëÁ†îÊó•Â∏∏', 'ËØªÁ†îÁîüÊ¥ª', 'Á≤æÁ•ûÁä∂ÊÄÅ', 'emo', 'Â¥©Ê∫É', 'Âä†Ê≤π', 'Ê≠£ËÉΩÈáè']
      }
    ];
    
    let selectedTags = [];
    let currentPage = 0;
    let totalPages = 1;
    let pagesData = [];
    
    // ========== Â≠òÂÇ®ÂáΩÊï∞ ==========
    const NOTES_KEY = 'xhs_notes_v1';
    const BACKUP_FILE = 'xhs_backup.json';
    
    function getTopics() {
      return JSON.parse(localStorage.getItem(TOPICS_KEY) || '[]');
    }
    function saveTopicsData(topics) {
      localStorage.setItem(TOPICS_KEY, JSON.stringify(topics));
      scheduleBackup();
    }
    function getHistory() {
      return JSON.parse(localStorage.getItem(HISTORY_KEY) || '[]');
    }
    function saveHistoryData(history) {
      // ÈôêÂà∂ÊúÄÂ§ö50Êù°
      if (history.length > MAX_HISTORY) {
        history = history.slice(0, MAX_HISTORY);
      }
      localStorage.setItem(HISTORY_KEY, JSON.stringify(history));
      scheduleBackup();
    }
    function getNotes() {
      return JSON.parse(localStorage.getItem(NOTES_KEY) || '[]');
    }
    function saveNotesData(notes) {
      localStorage.setItem(NOTES_KEY, JSON.stringify(notes));
      scheduleBackup();
    }
    
    // ========== Â§á‰ªΩÂäüËÉΩ ==========
    let backupTimer = null;
    let lastBackupData = '';
    let backupFileHandle = null; // ‰øùÂ≠òÊñá‰ª∂Âè•ÊüÑÔºåÁî®‰∫éËá™Âä®‰øùÂ≠ò
    
    function scheduleBackup() {
      // Èò≤ÊäñÔºö2ÁßíÂÜÖÂ§öÊ¨°‰øÆÊîπÂè™Â§á‰ªΩ‰∏ÄÊ¨°
      if (backupTimer) clearTimeout(backupTimer);
      backupTimer = setTimeout(autoBackup, 2000);
    }
    
    async function autoBackup() {
      const data = {
        version: 1,
        exportTime: new Date().toISOString(),
        topics: getTopics(),
        notes: getNotes(),
        history: getHistory()
      };
      const dataStr = JSON.stringify(data, null, 2);
      
      // Êï∞ÊçÆÊ≤°ÂèòÂåñÂ∞±‰∏çÂ§á‰ªΩ
      if (dataStr === lastBackupData) return;
      lastBackupData = dataStr;
      
      // ‰øùÂ≠òÂà∞localStorageÁöÑÂ§á‰ªΩÂâØÊú¨
      localStorage.setItem('xhs_backup_data', dataStr);
      localStorage.setItem('xhs_backup_time', new Date().toLocaleString());
      
      // Â¶ÇÊûúÂ∑≤ËÆæÁΩÆÂ§á‰ªΩÊñá‰ª∂ÔºåËá™Âä®‰øùÂ≠òÂà∞Êñá‰ª∂
      if (backupFileHandle) {
        try {
          const writable = await backupFileHandle.createWritable();
          await writable.write(dataStr);
          await writable.close();
          console.log('Ëá™Âä®‰øùÂ≠òÂà∞Êñá‰ª∂ÊàêÂäü');
        } catch (e) {
          console.warn('Ëá™Âä®‰øùÂ≠òÂ§±Ë¥•ÔºåÊñá‰ª∂Âè•ÊüÑÂèØËÉΩÂ∑≤Â§±Êïà', e);
          backupFileHandle = null;
          updateBackupStatus();
        }
      }
      
      updateBackupStatus();
    }
    
    function updateBackupStatus() {
      const time = localStorage.getItem('xhs_backup_time');
      const el = document.getElementById('backup-status');
      if (el) {
        if (backupFileHandle) {
          el.innerHTML = `‚úÖ Ëá™Âä®‰øùÂ≠òÂ∑≤ÂºÄÂêØ<br><small style="opacity:0.6">${time || ''}</small>`;
          el.style.color = '#4caf50';
        } else if (time) {
          el.innerHTML = `‰∏äÊ¨°‰øùÂ≠ò: ${time}<br><small style="opacity:0.6">ÁÇπÂáª‰∏ãÊñπËÆæÁΩÆËá™Âä®‰øùÂ≠ò</small>`;
          el.style.color = '';
        }
      }
    }
    
    // ËÆæÁΩÆËá™Âä®‰øùÂ≠òË∑ØÂæÑ
    async function setupAutoSave() {
      if (!('showSaveFilePicker' in window)) {
        alert('‰Ω†ÁöÑÊµèËßàÂô®‰∏çÊîØÊåÅÊ≠§ÂäüËÉΩÔºåËØ∑‰ΩøÁî®ÊúÄÊñ∞Áâà Chrome Êàñ Edge');
        return;
      }
      
      try {
        // ËÆ©Áî®Êà∑ÈÄâÊã©‰øùÂ≠ò‰ΩçÁΩÆ
        backupFileHandle = await window.showSaveFilePicker({
          suggestedName: 'xhs_backup.json',
          types: [{
            description: 'Â§á‰ªΩÊñá‰ª∂',
            accept: { 'application/json': ['.json'] }
          }]
        });
        
        // Á´ãÂç≥‰øùÂ≠ò‰∏ÄÊ¨°
        await autoBackup();
        showToast('Ëá™Âä®‰øùÂ≠òÂ∑≤ËÆæÁΩÆÔºÅÊï∞ÊçÆ‰ºöËá™Âä®‰øùÂ≠òÂà∞ËØ•Êñá‰ª∂');
        updateBackupStatus();
      } catch (e) {
        if (e.name !== 'AbortError') {
          console.error(e);
          alert('ËÆæÁΩÆÂ§±Ë¥•: ' + e.message);
        }
      }
    }
    
    function exportBackup() {
      const data = {
        version: 1,
        exportTime: new Date().toISOString(),
        topics: getTopics(),
        notes: getNotes(),
        history: getHistory()
      };
      
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `Â∞èÁ∫¢‰π¶Êï∞ÊçÆÂ§á‰ªΩ_${new Date().toLocaleDateString().replace(/\//g, '-')}.json`;
      a.click();
      URL.revokeObjectURL(url);
      showToast('Â§á‰ªΩÊñá‰ª∂Â∑≤‰∏ãËΩΩ');
    }
    
    function importBackup() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = '.json';
      input.onchange = (e) => {
        const file = e.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = (event) => {
          try {
            const data = JSON.parse(event.target.result);
            
            if (!data.topics && !data.notes && !data.history) {
              alert('Êó†ÊïàÁöÑÂ§á‰ªΩÊñá‰ª∂');
              return;
            }
            
            const topicCount = data.topics?.length || 0;
            const noteCount = data.notes?.length || 0;
            const historyCount = data.history?.length || 0;
            
            if (!confirm(`Á°ÆËÆ§ÂØºÂÖ•Ôºü\n\nÈÄâÈ¢ò: ${topicCount} Êù°\nÂøÉÂæó: ${noteCount} Êù°\nÂéÜÂè≤: ${historyCount} Êù°\n\n‚ö†Ô∏è ËøôÂ∞ÜË¶ÜÁõñÂΩìÂâçÊâÄÊúâÊï∞ÊçÆÔºÅ`)) {
              return;
            }
            
            if (data.topics) localStorage.setItem(TOPICS_KEY, JSON.stringify(data.topics));
            if (data.notes) localStorage.setItem(NOTES_KEY, JSON.stringify(data.notes));
            if (data.history) localStorage.setItem(HISTORY_KEY, JSON.stringify(data.history));
            
            renderTopics();
            renderNotes();
            renderHistory();
            showToast('Êï∞ÊçÆÂ∑≤ÊÅ¢Â§ç');
          } catch (err) {
            alert('Êñá‰ª∂Ëß£ÊûêÂ§±Ë¥•: ' + err.message);
          }
        };
        reader.readAsText(file);
      };
      input.click();
    }
    
    // ========== ‰æßËæπÊ†è ==========
    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('show');
      document.getElementById('sidebar-overlay').classList.toggle('show');
      renderTopics();
      renderNotes();
      renderHistory();
    }
    
    function switchTab(tab) {
      document.querySelectorAll('.sidebar-tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      
      document.querySelector(`.sidebar-tab[onclick="switchTab('${tab}')"]`).classList.add('active');
      document.getElementById(`tab-${tab}`).classList.add('active');
      
      if (tab === 'history') renderHistory();
      else if (tab === 'notes') renderNotes();
      else renderTopics();
    }
    
    // ========== ÈÄâÈ¢òÂ∫ì ==========
    function openNewTopicModal() {
      document.getElementById('topic-modal').classList.add('show');
      document.getElementById('new-topic-title').value = '';
      document.getElementById('new-topic-content').value = '';
      document.getElementById('new-topic-title').focus();
    }
    
    function closeTopicModal() {
      document.getElementById('topic-modal').classList.remove('show');
    }
    
    function saveTopic() {
      const title = document.getElementById('new-topic-title').value.trim();
      const content = document.getElementById('new-topic-content').value.trim();
      if (!title) { alert('ËØ∑ËæìÂÖ•ÈÄâÈ¢òÊ†áÈ¢ò'); return; }
      
      const topics = getTopics();
      topics.unshift({ id: Date.now(), title, content, createdAt: Date.now() });
      saveTopicsData(topics);
      renderTopics();
      closeTopicModal();
    }
    
    function saveCurrentAsTopic() {
      const title = document.getElementById('memo-title').value.trim();
      const content = document.getElementById('memo-content').value.trim();
      if (!title) { alert('ËØ∑ÂÖàËæìÂÖ•Ê†áÈ¢ò'); return; }
      
      const topics = getTopics();
      topics.unshift({ id: Date.now(), title, content, createdAt: Date.now() });
      saveTopicsData(topics);
      showToast('Â∑≤‰øùÂ≠òÂà∞ÈÄâÈ¢òÂ∫ì');
      renderTopics();
    }
    
    function useTopic(id) {
      const topics = getTopics();
      const topic = topics.find(t => t.id === id);
      if (topic) {
        document.getElementById('memo-title').value = topic.title;
        if (topic.content) document.getElementById('memo-content').value = topic.content;
        updatePreview();
        toggleSidebar();
      }
    }
    
    function archiveTopic(id) {
      const topics = getTopics();
      const index = topics.findIndex(t => t.id === id);
      if (index > -1) {
        const topic = topics[index];
        // ÁßªÂà∞ÂéÜÂè≤ËÆ∞ÂΩï
        const history = getHistory();
        history.unshift({
          id: Date.now(),
          title: topic.title,
          content: topic.content,
          archivedAt: Date.now()
        });
        saveHistoryData(history);
        // ‰ªéÈÄâÈ¢òÂ∫ìÂà†Èô§
        topics.splice(index, 1);
        saveTopicsData(topics);
        renderTopics();
        showToast('Â∑≤ÁßªËá≥ÂéÜÂè≤ËÆ∞ÂΩï');
      }
    }
    
    function deleteTopic(id) {
      if (!confirm('Á°ÆÂÆöÂà†Èô§Ôºü')) return;
      const topics = getTopics();
      const index = topics.findIndex(t => t.id === id);
      if (index > -1) {
        topics.splice(index, 1);
        saveTopicsData(topics);
        renderTopics();
      }
    }
    
    function renderTopics() {
      const topics = getTopics();
      const el = document.getElementById('topic-list');
      
      if (topics.length === 0) {
        el.innerHTML = '<div class="topic-empty"><div class="topic-empty-icon">üìù</div><div class="topic-empty-text">ÊöÇÊó†ÈÄâÈ¢ò</div></div>';
        return;
      }
      
      el.innerHTML = topics.map(t => `
        <div class="topic-card">
          <div class="topic-card-header">
            <div class="topic-card-title" onclick="useTopic(${t.id})">${t.title}</div>
            <div class="topic-card-actions">
              <button class="use-btn" onclick="useTopic(${t.id})" title="‰ΩøÁî®">‚úì</button>
              <button class="archive-btn" onclick="archiveTopic(${t.id})" title="Ê†áËÆ∞Â∑≤Áî®">üìÅ</button>
              <button class="delete-btn" onclick="deleteTopic(${t.id})" title="Âà†Èô§">√ó</button>
            </div>
          </div>
          ${t.content ? `<div class="topic-card-content">${t.content.substring(0, 80)}...</div>` : ''}
          <div class="topic-card-meta">
            <span class="topic-card-date">${formatDate(t.createdAt)}</span>
          </div>
        </div>
      `).join('');
    }
    
    // ========== ÂÜô‰ΩúÂøÉÂæó ==========
    const NOTE_TYPES = {
      success: { icon: '‚úÖ', label: 'ÊàêÂäüÁªèÈ™å', color: '#4caf50' },
      fail: { icon: '‚ùå', label: 'Ë∏©ÂùëÊïôËÆ≠', color: '#f44336' },
      idea: { icon: 'üí°', label: 'ÁÅµÊÑüÊÉ≥Ê≥ï', color: '#ff9800' },
      data: { icon: 'üìä', label: 'Êï∞ÊçÆÂ§çÁõò', color: '#2196f3' }
    };
    
    let editingNoteId = null; // Ê≠£Âú®ÁºñËæëÁöÑÂøÉÂæóID
    
    function openNewNoteModal() {
      editingNoteId = null;
      document.getElementById('note-modal-title').textContent = 'üí° ËÆ∞ÂΩïÂøÉÂæó';
      document.getElementById('note-type').value = 'success';
      document.getElementById('note-content').value = '';
      document.getElementById('note-modal').classList.add('show');
      document.getElementById('note-content').focus();
    }
    
    function editNote(id) {
      const notes = getNotes();
      const note = notes.find(n => n.id === id);
      if (!note) return;
      
      editingNoteId = id;
      document.getElementById('note-modal-title').textContent = '‚úèÔ∏è ÁºñËæëÂøÉÂæó';
      document.getElementById('note-type').value = note.type;
      document.getElementById('note-content').value = note.content;
      document.getElementById('note-modal').classList.add('show');
      document.getElementById('note-content').focus();
    }
    
    function closeNoteModal() {
      document.getElementById('note-modal').classList.remove('show');
      editingNoteId = null;
    }
    
    function saveNote() {
      const type = document.getElementById('note-type').value;
      const content = document.getElementById('note-content').value.trim();
      if (!content) { alert('ËØ∑ËæìÂÖ•ÂøÉÂæóÂÜÖÂÆπ'); return; }
      
      const notes = getNotes();
      
      if (editingNoteId) {
        // ÁºñËæëÊ®°Âºè
        const index = notes.findIndex(n => n.id === editingNoteId);
        if (index > -1) {
          notes[index].type = type;
          notes[index].content = content;
          notes[index].updatedAt = Date.now();
        }
        showToast('ÂøÉÂæóÂ∑≤Êõ¥Êñ∞');
      } else {
        // Êñ∞Âª∫Ê®°Âºè
        notes.unshift({ id: Date.now(), type, content, createdAt: Date.now() });
        showToast('ÂøÉÂæóÂ∑≤‰øùÂ≠ò');
      }
      
      saveNotesData(notes);
      renderNotes();
      closeNoteModal();
    }
    
    function deleteNote(id) {
      if (!confirm('Á°ÆÂÆöÂà†Èô§ËøôÊù°ÂøÉÂæóÔºü')) return;
      const notes = getNotes();
      const index = notes.findIndex(n => n.id === id);
      if (index > -1) {
        notes.splice(index, 1);
        saveNotesData(notes);
        renderNotes();
      }
    }
    
    function renderNotes() {
      const notes = getNotes();
      const el = document.getElementById('notes-list');
      
      if (notes.length === 0) {
        el.innerHTML = '<div class="topic-empty"><div class="topic-empty-icon">üí°</div><div class="topic-empty-text">ÊöÇÊó†ÂøÉÂæó<br><small style="opacity:0.5">ËÆ∞ÂΩï‰Ω†ÁöÑËøêËê•ÁªèÈ™åÂíåÊïôËÆ≠</small></div></div>';
        return;
      }
      
      el.innerHTML = notes.map(n => {
        const typeInfo = NOTE_TYPES[n.type] || NOTE_TYPES.idea;
        return `
          <div class="topic-card note-card" style="border-left: 3px solid ${typeInfo.color}">
            <div class="topic-card-header">
              <div class="note-type-badge" style="background: ${typeInfo.color}">${typeInfo.icon} ${typeInfo.label}</div>
              <div class="topic-card-actions">
                <button class="edit-btn" onclick="editNote(${n.id})" title="ÁºñËæë">‚úèÔ∏è</button>
                <button class="delete-btn" onclick="deleteNote(${n.id})" title="Âà†Èô§">√ó</button>
              </div>
            </div>
            <div class="note-card-content">${n.content}</div>
            <div class="topic-card-meta">
              <span class="topic-card-date">${formatDate(n.createdAt)}${n.updatedAt ? ' (Â∑≤ÁºñËæë)' : ''}</span>
            </div>
          </div>
        `;
      }).join('');
    }
    
    // ========== ÂéÜÂè≤ËÆ∞ÂΩï ==========
    function renderHistory() {
      const history = getHistory();
      const el = document.getElementById('history-list');
      
      if (history.length === 0) {
        el.innerHTML = '<div class="topic-empty"><div class="topic-empty-icon">üìú</div><div class="topic-empty-text">ÊöÇÊó†ÂéÜÂè≤ËÆ∞ÂΩï<br><small style="opacity:0.5">ÈÄâÈ¢òÊ†áËÆ∞Â∑≤Áî®Âêé‰ºöÂá∫Áé∞Âú®ËøôÈáå</small></div></div>';
        return;
      }
      
      el.innerHTML = history.map(h => `
        <div class="topic-card">
          <div class="topic-card-header">
            <div class="topic-card-title" onclick="useHistory(${h.id})">${h.title}</div>
            <div class="topic-card-actions">
              <button class="use-btn" onclick="useHistory(${h.id})" title="ÂÜçÊ¨°‰ΩøÁî®">‚Ü∫</button>
              <button class="delete-btn" onclick="deleteHistory(${h.id})" title="Âà†Èô§">√ó</button>
            </div>
          </div>
          ${h.content ? `<div class="topic-card-content">${h.content.substring(0, 80)}...</div>` : ''}
          <div class="topic-card-meta">
            <span class="topic-card-date">${formatDate(h.archivedAt)}</span>
          </div>
        </div>
      `).join('');
    }
    
    function useHistory(id) {
      const history = getHistory();
      const item = history.find(h => h.id === id);
      if (item) {
        document.getElementById('memo-title').value = item.title;
        if (item.content) document.getElementById('memo-content').value = item.content;
        updatePreview();
        toggleSidebar();
      }
    }
    
    function deleteHistory(id) {
      if (!confirm('Á°ÆÂÆöÂà†Èô§Ôºü')) return;
      const history = getHistory();
      const index = history.findIndex(h => h.id === id);
      if (index > -1) {
        history.splice(index, 1);
        saveHistoryData(history);
        renderHistory();
      }
    }
    
    // ========== Êé®ÊµÅÊú∫Âà∂ÂºπÁ™ó ==========
    function openFlowModal() {
      document.getElementById('flow-modal').classList.add('show');
    }
    function closeFlowModal() {
      document.getElementById('flow-modal').classList.remove('show');
    }
    
    // ========== Ê†áÁ≠æËØçÂ∫ì ==========
    function openTagsModal() {
      selectedTags = [];
      renderTagsModal();
      document.getElementById('tags-modal').classList.add('show');
    }
    
    function closeTagsModal() {
      document.getElementById('tags-modal').classList.remove('show');
    }
    
    function renderTagsModal() {
      const body = document.getElementById('tags-body');
      body.innerHTML = TAG_CATEGORIES.map(cat => `
        <div class="tag-category">
          <div class="tag-category-title">${cat.name}</div>
          <div class="tag-list">
            ${cat.tags.map(tag => `
              <div class="tag-item ${selectedTags.includes(tag) ? 'selected' : ''}" onclick="toggleTag('${tag}')">#${tag}</div>
            `).join('')}
          </div>
        </div>
      `).join('');
      
      document.getElementById('selected-tags').textContent = selectedTags.map(t => '#' + t).join(' ');
    }
    
    function toggleTag(tag) {
      const index = selectedTags.indexOf(tag);
      if (index > -1) {
        selectedTags.splice(index, 1);
      } else {
        selectedTags.push(tag);
      }
      renderTagsModal();
    }
    
    function clearSelectedTags() {
      selectedTags = [];
      renderTagsModal();
    }
    
    function copySelectedTags() {
      if (selectedTags.length === 0) {
        alert('ËØ∑ÂÖàÈÄâÊã©Ê†áÁ≠æ');
        return;
      }
      const text = selectedTags.map(t => '#' + t).join(' ');
      navigator.clipboard.writeText(text).then(() => {
        showToast('Â∑≤Â§çÂà∂Ôºö' + text);
      });
    }
    
    // ========== Â∑•ÂÖ∑ÂáΩÊï∞ ==========
    function formatDate(ts) {
      const d = new Date(ts);
      return `${d.getMonth() + 1}Êúà${d.getDate()}Êó•`;
    }
    
    function showToast(msg) {
      const toast = document.getElementById('toast');
      toast.textContent = '‚úì ' + msg;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 2000);
    }
    
    // ========== Á¨îËÆ∞ÁîüÊàê ==========
    function parseContent(text) {
      const lines = text.split('\n');
      const result = [];
      let tableBuffer = [];
      let inTable = false;
      
      for (let i = 0; i < lines.length; i++) {
        const line = lines[i];
        const trimmed = line.trim();
        
        // Ê£ÄÊµãÊòØÂê¶ÊòØË°®Ê†ºË°å
        const isTableRow = /^\|.+\|$/.test(trimmed);
        const isSeparator = /^\|[-:\s|]+\|$/.test(trimmed);
        
        if (isTableRow || isSeparator) {
          if (!isSeparator) {
            tableBuffer.push(trimmed);
          }
          inTable = true;
          continue;
        }
        
        // Â¶ÇÊûúÂàöÁªìÊùüË°®Ê†º
        if (inTable && tableBuffer.length > 0) {
          result.push(buildTable(tableBuffer));
          tableBuffer = [];
          inTable = false;
        }
        
        // Â§ÑÁêÜÊôÆÈÄöË°å
        result.push(parseLine(line));
      }
      
      // Â§ÑÁêÜÊú´Â∞æÁöÑË°®Ê†º
      if (tableBuffer.length > 0) {
        result.push(buildTable(tableBuffer));
      }
      
      return result.join('');
    }
    
    // ÂçïË°åËß£Êûê
    function parseLine(line) {
      const html = line;
      const trimmed = html.trim();
      
      // Á©∫Ë°å
      if (!trimmed) {
        return `<div class="text-line empty"></div>`;
      }
      
      // ÂõæÁâá ![alt|align|size](imgId) Êàñ ![alt](url)
      if (/^!\[.*?\]\(.+?\)$/.test(trimmed)) {
        const match = trimmed.match(/^!\[(.*?)\]\((.+?)\)$/);
        if (match) {
          const params = match[1].split('|');
          const alt = params[0] || 'ÂõæÁâá';
          const align = params.find(p => ['left', 'center', 'right'].includes(p)) || 'center';
          const size = params.find(p => ['small', 'medium', 'large', 'full'].includes(p)) || 'medium';
          const src = match[2];
          // Ê£ÄÊü•ÊòØÂê¶ÊòØÂÜÖÈÉ®Â≠òÂÇ®ÁöÑÂõæÁâá
          const imgSrc = imageStore[src] || src;
          return `<div class="image-container align-${align}"><img src="${imgSrc}" alt="${alt}" class="memo-image size-${size}" data-imgid="${src}" onclick="openImageEditor('${src}')"></div>`;
        }
      }
      
      // „ÄêÂ∞èÊ†áÈ¢ò„Äë ‚Üí Â∏¶ËÉåÊôØÁöÑÊ†áÈ¢òÂùó
      if (/^„Äê[^Ôºö]+„Äë$/.test(trimmed)) {
        const title = trimmed.slice(1, -1);
        return `<div class="section-title">${title}</div>`;
      }
      
      // „ÄêxxxÔºöÂÜÖÂÆπ„Äë ‚Üí Â∏¶Ê†áÁ≠æÁöÑÊ†áÈ¢ò
      if (/^„Äê.+Ôºö.+„Äë$/.test(trimmed)) {
        const match = trimmed.match(/^„Äê(.+?)Ôºö(.+)„Äë$/);
        if (match) {
          return `<div class="section-title"><span class="section-label">${match[1]}</span>${match[2]}</div>`;
        }
      }
      
      // ‚ñ∏ Êàñ ‚ñ∂ ÂºÄÂ§¥ ‚Üí Âº∫Ë∞ÉÂàóË°®È°π
      if (/^[‚ñ∏‚ñ∂‚ñ∫]/.test(trimmed)) {
        const content = trimmed.slice(1).trim();
        return `<div class="list-item accent"><span class="list-dot">‚ñ∏</span>${parseInline(content)}</div>`;
      }
      
      // ‚Ä¢ ÂºÄÂ§¥ ‚Üí ÂàóË°®È°π
      if (/^[‚Ä¢¬∑]/.test(trimmed)) {
        const content = trimmed.slice(1).trim();
        return `<div class="list-item"><span class="list-dot">‚Ä¢</span>${parseInline(content)}</div>`;
      }
      
      // ‚úì ‚úî ‚òë ÂºÄÂ§¥ ‚Üí ÂÆåÊàêÈ°π
      if (/^[‚úì‚úî‚òë]/.test(trimmed)) {
        const content = trimmed.slice(1).trim();
        return `<div class="list-item check"><span class="list-dot">‚úì</span>${parseInline(content)}</div>`;
      }
      
      // ‚úó ‚úò ‚òí X ÂºÄÂ§¥ ‚Üí ÈîôËØØÈ°π
      if (/^[‚úó‚úò‚òí‚úïX]/.test(trimmed) && !/^XG/.test(trimmed)) {
        const content = trimmed.slice(1).trim();
        return `<div class="list-item cross"><span class="list-dot">‚úó</span>${parseInline(content)}</div>`;
      }
      
      // üî• ‚≠ê üí° Á≠âemojiÂºÄÂ§¥ ‚Üí ÂõæÊ†áË°å
      if (/^[\u{1F300}-\u{1F9FF}]/u.test(trimmed)) {
        return `<div class="icon-line">${parseInline(trimmed)}</div>`;
      }
      
      // --- Êàñ === ÂàÜÂâ≤Á∫ø
      if (/^[-=]{3,}$/.test(trimmed)) {
        return `<div class="divider"></div>`;
      }
      
      // > ÂºïÁî®Âùó
      if (/^>/.test(trimmed)) {
        const content = trimmed.slice(1).trim();
        return `<div class="quote-block">${parseInline(content)}</div>`;
      }
      
      // Êï∞Â≠óÂ∫èÂè∑ÂºÄÂ§¥ ‚ë†‚ë°‚ë¢ Êàñ 1. 2. 3.
      if (/^[‚ë†‚ë°‚ë¢‚ë£‚ë§‚ë•‚ë¶‚ëß‚ë®‚ë©]/.test(trimmed)) {
        const num = trimmed[0];
        const content = trimmed.slice(1).trim();
        return `<div class="step-item"><span class="step-num">${num}</span>${parseInline(content)}</div>`;
      }
      if (/^\d+[.„ÄÅ]/.test(trimmed)) {
        const match = trimmed.match(/^(\d+)[.„ÄÅ]\s*(.*)$/);
        if (match) {
          const circleNums = ['‚ë†','‚ë°','‚ë¢','‚ë£','‚ë§','‚ë•','‚ë¶','‚ëß','‚ë®','‚ë©'];
          const num = circleNums[parseInt(match[1]) - 1] || match[1];
          return `<div class="step-item"><span class="step-num">${num}</span>${parseInline(match[2])}</div>`;
        }
      }
      
      // ÊôÆÈÄöË°å
      return `<div class="text-line">${parseInline(html)}</div>`;
    }
    
    // ÊûÑÂª∫Ë°®Ê†ºHTML
    function buildTable(lines) {
      if (lines.length === 0) return '';
      
      let html = '<div class="table-wrapper"><table class="memo-table">';
      
      lines.forEach((line, idx) => {
        const cells = line.split('|').filter(c => c !== '');
        const tag = idx === 0 ? 'th' : 'td';
        const rowClass = idx === 0 ? 'header' : (idx % 2 === 0 ? 'even' : 'odd');
        
        html += `<tr class="${rowClass}">`;
        cells.forEach(cell => {
          html += `<${tag}>${parseInline(cell.trim())}</${tag}>`;
        });
        html += '</tr>';
      });
      
      html += '</table></div>';
      return html;
    }
    
    // Ë°åÂÜÖÊ†ºÂºèËß£Êûê
    function parseInline(text) {
      let html = text;
      // **Âä†Á≤ó**
      html = html.replace(/\*\*([^*]+)\*\*/g, '<span class="bold">$1</span>');
      // ==È´ò‰∫Æ==
      html = html.replace(/==([^=]+)==/g, '<span class="highlight">$1</span>');
      // ~~Âà†Èô§Á∫ø~~
      html = html.replace(/~~([^~]+)~~/g, '<span class="strikethrough">$1</span>');
      // `‰ª£Á†Å`
      html = html.replace(/`([^`]+)`/g, '<span class="code-inline">$1</span>');
      // „ÄåÂºïÁî®„Äç
      html = html.replace(/„Äå([^„Äç]+)„Äç/g, '<span class="quote-text">$1</span>');
      // „ÄéÈáçÁÇπ„Äè
      html = html.replace(/„Äé([^„Äè]+)„Äè/g, '<span class="emphasis-box">$1</span>');
      // ‚ÜíÁÆ≠Â§¥
      html = html.replace(/‚Üí/g, '<span class="arrow">‚Üí</span>');
      // ÂÜíÂè∑ÂêéÂÜÖÂÆπÔºàÁî®‰∫é ËæìÂÖ•Ôºöxxx ËøôÁßçÊ†ºÂºèÔºâ
      html = html.replace(/^([\u4e00-\u9fa5]+)Ôºö/g, '<span class="label">$1Ôºö</span>');
      return html;
    }
    
    // ========== ÂõæÁâáÊãñÊãΩÂäüËÉΩ ==========
    const imageStore = {}; // Â≠òÂÇ®ÂõæÁâá base64
    
    function setupImageDrag() {
      const textarea = document.getElementById('memo-content');
      
      textarea.addEventListener('dragover', (e) => {
        e.preventDefault();
        e.stopPropagation();
        textarea.classList.add('drag-over');
      });
      
      textarea.addEventListener('dragleave', (e) => {
        e.preventDefault();
        e.stopPropagation();
        textarea.classList.remove('drag-over');
      });
      
      textarea.addEventListener('drop', (e) => {
        e.preventDefault();
        e.stopPropagation();
        textarea.classList.remove('drag-over');
        
        const files = e.dataTransfer.files;
        if (files.length === 0) return;
        
        for (let file of files) {
          if (file.type.startsWith('image/')) {
            handleImageFile(file, textarea);
          }
        }
      });
      
      // ÊîØÊåÅÁ≤òË¥¥ÂõæÁâáÂíåÊñáÊú¨
      textarea.addEventListener('paste', (e) => {
        const items = e.clipboardData.items;
        let hasImage = false;
        for (let item of items) {
          if (item.type.startsWith('image/')) {
            e.preventDefault();
            const file = item.getAsFile();
            handleImageFile(file, textarea);
            hasImage = true;
            break;
          }
        }
        // Á≤òË¥¥ÊñáÊú¨Êó∂ÔºåÂª∂ËøüÈáçÁΩÆÂà∞Á¨¨‰∏ÄÈ°µ
        if (!hasImage) {
          setTimeout(() => {
            updatePreview(true); // ÈáçÁΩÆÂà∞Á¨¨‰∏ÄÈ°µ
          }, 10);
        }
      });
    }
    
    function handleImageFile(file, textarea) {
      const reader = new FileReader();
      reader.onload = (e) => {
        const base64 = e.target.result;
        const imgId = 'img_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        imageStore[imgId] = base64;
        
        // Âú®ÂÖâÊ†á‰ΩçÁΩÆÊèíÂÖ•ÂõæÁâáÊ†áËÆ∞ÔºåÈªòËÆ§‰∏≠Á≠âÂ§ßÂ∞èÂ±Ö‰∏≠
        const cursorPos = textarea.selectionStart;
        const textBefore = textarea.value.substring(0, cursorPos);
        const textAfter = textarea.value.substring(cursorPos);
        const imgTag = `\n![ÂõæÁâá|center|medium](${imgId})\n`;
        
        textarea.value = textBefore + imgTag + textAfter;
        textarea.selectionStart = textarea.selectionEnd = cursorPos + imgTag.length;
        textarea.focus();
        
        updatePreview();
        showToast('ÂõæÁâáÂ∑≤ÊèíÂÖ•ÔºåÁÇπÂáªÂõæÁâáÂèØÁºñËæë');
      };
      reader.readAsDataURL(file);
    }
    
    // ÂõæÁâáÁºñËæëÂäüËÉΩ
    let currentEditingImgId = null;
    
    function openImageEditor(imgId) {
      currentEditingImgId = imgId;
      const textarea = document.getElementById('memo-content');
      const content = textarea.value;
      
      // Ëß£ÊûêÂΩìÂâçÂõæÁâáÁöÑËÆæÁΩÆ
      const regex = new RegExp(`!\\[([^\\]]*?)\\]\\(${imgId}\\)`);
      const match = content.match(regex);
      
      let align = 'center', size = 'medium';
      if (match) {
        const params = match[1].split('|');
        align = params.find(p => ['left', 'center', 'right'].includes(p)) || 'center';
        size = params.find(p => ['small', 'medium', 'large', 'full'].includes(p)) || 'medium';
      }
      
      document.getElementById('img-align').value = align;
      document.getElementById('img-size').value = size;
      
      // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
      document.querySelectorAll('.align-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.value === align);
      });
      document.querySelectorAll('.size-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.value === size);
      });
      
      // ÊòæÁ§∫È¢ÑËßà
      document.getElementById('img-preview').src = imageStore[imgId] || imgId;
      document.getElementById('image-editor-modal').classList.add('show');
    }
    
    function closeImageEditor() {
      document.getElementById('image-editor-modal').classList.remove('show');
      currentEditingImgId = null;
    }
    
    function applyImageSettings(closeAfter = true) {
      if (!currentEditingImgId) return;
      
      const align = document.getElementById('img-align').value;
      const size = document.getElementById('img-size').value;
      const textarea = document.getElementById('memo-content');
      
      // ÊõøÊç¢ÂõæÁâáÊ†áËÆ∞
      const regex = new RegExp(`!\\[[^\\]]*?\\]\\(${currentEditingImgId}\\)`);
      textarea.value = textarea.value.replace(regex, `![ÂõæÁâá|${align}|${size}](${currentEditingImgId})`);
      
      updatePreview();
      
      if (closeAfter) {
        closeImageEditor();
        showToast('ÂõæÁâáËÆæÁΩÆÂ∑≤Êõ¥Êñ∞');
      }
    }
    
    function deleteImage() {
      if (!currentEditingImgId) return;
      if (!confirm('Á°ÆÂÆöÂà†Èô§ËøôÂº†ÂõæÁâáÂêóÔºü')) return;
      
      const textarea = document.getElementById('memo-content');
      const regex = new RegExp(`\\n?!\\[[^\\]]*?\\]\\(${currentEditingImgId}\\)\\n?`);
      textarea.value = textarea.value.replace(regex, '\n');
      
      delete imageStore[currentEditingImgId];
      updatePreview();
      closeImageEditor();
      showToast('ÂõæÁâáÂ∑≤Âà†Èô§');
    }
    
    function setAlign(value) {
      document.getElementById('img-align').value = value;
      document.querySelectorAll('.align-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.value === value);
      });
      // ÂÆûÊó∂È¢ÑËßàÔºå‰∏çÂÖ≥Èó≠ÂºπÁ™ó
      applyImageSettings(false);
    }
    
    function setSize(value) {
      document.getElementById('img-size').value = value;
      document.querySelectorAll('.size-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.value === value);
      });
      // ÂÆûÊó∂È¢ÑËßàÔºå‰∏çÂÖ≥Èó≠ÂºπÁ™ó
      applyImageSettings(false);
    }
    
    // ========== ‰∏ªÈ¢òÂàáÊç¢ ==========
    let currentTheme = 'memo';
    
    function switchTheme(theme) {
      currentTheme = theme;
      
      // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
      document.querySelectorAll('.theme-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.theme === theme);
      });
      
      // Êõ¥Êñ∞È¢ÑËßàÂå∫ÂüüÁöÑ‰∏ªÈ¢òÁ±ª
      const previewContainer = document.getElementById('preview-container');
      const exportContainer = document.getElementById('export-container');
      
      // ÁßªÈô§ÊâÄÊúâ‰∏ªÈ¢òÁ±ª
      previewContainer.classList.remove('theme-memo', 'theme-zhihu', 'theme-dark');
      exportContainer.classList.remove('theme-memo', 'theme-zhihu', 'theme-dark');
      
      // Ê∑ªÂä†ÂΩìÂâç‰∏ªÈ¢òÁ±ª
      previewContainer.classList.add(`theme-${theme}`);
      exportContainer.classList.add(`theme-${theme}`);
      
      // ‰øùÂ≠òÂà∞localStorage
      localStorage.setItem('noteTheme', theme);
      
      updatePreview();
    }
    
    // ÂàùÂßãÂåñ‰∏ªÈ¢ò
    function initTheme() {
      const savedTheme = localStorage.getItem('noteTheme') || 'memo';
      switchTheme(savedTheme);
    }
    
    function calculatePages(content) {
      // ÊØèÈ°µÊúÄÂ§ßË°åÊï∞ÔºàÁÆÄÂçïÂèØÈù†Ôºâ
      const firstPageLines = 18;   // Á¨¨‰∏ÄÈ°µÊúâÊ†áÈ¢òÔºåÂ∞ëÊîæÂá†Ë°å
      const otherPageLines = 22;   // ÂÖ∂‰ªñÈ°µÂèØ‰ª•Â§öÊîæ
      
      const lines = content.split('\n');
      const pages = [];
      let currentPageLines = [];
      let isFirstPage = true;
      
      for (let i = 0; i < lines.length; i++) {
        const line = lines[i];
        const trimmed = line.trim();
        
        // Ë∑≥ËøáË°®Ê†ºÂàÜÈöîË°åÔºà|---|---|Ôºâ‰∏çÂç†Ë°åÊï∞
        if (/^\|[-:\s|]+\|$/.test(trimmed)) {
          currentPageLines.push(line);
          continue;
        }
        
        // ËÆ°ÁÆóËøô‰∏ÄË°åÂç†Â§öÂ∞ë"ÈÄªËæëË°å"
        let lineCount = 1;
        
        // Ë°®Ê†ºË°åÂç†1Ë°å
        if (/^\|.+\|$/.test(trimmed)) {
          lineCount = 1;
        }
        // Ê†áÈ¢òÂùóÂç†1.5Ë°å
        else if (trimmed.startsWith('„Äê') && trimmed.endsWith('„Äë')) {
          lineCount = 1.5;
        }
        // ÂõæÁâáÂç†4Ë°å
        else if (trimmed.startsWith('![') && trimmed.includes('](')) {
          lineCount = 4;
        }
        // Á©∫Ë°åÂç†0.5Ë°å
        else if (!trimmed) {
          lineCount = 0.5;
        }
        // ÈïøÊñáÊú¨Ë°åÂèØËÉΩÂç†Â§öË°å
        else if (line.length > 35) {
          lineCount = Math.ceil(line.length / 35);
        }
        
        const maxLines = isFirstPage ? firstPageLines : otherPageLines;
        const currentCount = currentPageLines.filter(l => !/^\|[-:\s|]+\|$/.test(l.trim())).length;
        
        // Ê£ÄÊü•ÊòØÂê¶ÈúÄË¶ÅÊç¢È°µ
        if (currentCount + lineCount > maxLines && currentPageLines.length > 0) {
          pages.push(currentPageLines.join('\n'));
          currentPageLines = [line];
          isFirstPage = false;
        } else {
          currentPageLines.push(line);
        }
      }
      if (currentPageLines.length > 0) pages.push(currentPageLines.join('\n'));
      return pages.length > 0 ? pages : [''];
    }
    
    function parseSubtitle(text) {
      if (!text.trim()) return null;
      const match = text.match(/^(.+?)\s*(\d+)\s*$/);
      if (match) return { text: match[1].trim(), number: match[2] };
      return { text: text, number: null };
    }
    
    function generatePageHTML(title, subtitle, content, pageNum, total) {
      const parsedContent = parseContent(content);
      const showPageNum = total > 1;
      const subtitleData = parseSubtitle(subtitle);
      
      let subtitleHTML = '';
      if (subtitleData) {
        subtitleHTML = `<div class="memo-subtitle">${subtitleData.text}${subtitleData.number ? `<span class="tag">${subtitleData.number}</span>` : ''}</div>`;
      }
      
      const isFirstPage = pageNum === 1;
      
      return `
        <div class="memo-page">
          <div class="memo-inner ${!isFirstPage ? 'no-title' : ''}">
            ${isFirstPage ? `<div class="memo-title">${title}</div>${subtitleHTML}` : ''}
            <div class="memo-body"><div class="memo-content">${parsedContent}</div></div>
            ${showPageNum ? `<div class="page-indicator">${pageNum} / ${total}</div>` : ''}
          </div>
        </div>
      `;
    }
    
    function updatePreview(resetToFirstPage = false) {
      const title = document.getElementById('memo-title').value || 'Ê†áÈ¢ò';
      const subtitle = document.getElementById('memo-subtitle').value || '';
      const content = document.getElementById('memo-content').value || '';
      
      pagesData = calculatePages(content);
      totalPages = pagesData.length;
      
      // Â¶ÇÊûúÈúÄË¶ÅÈáçÁΩÆÂà∞Á¨¨‰∏ÄÈ°µÔºàÊØîÂ¶ÇÁ≤òË¥¥Êñ∞ÂÜÖÂÆπÊó∂Ôºâ
      if (resetToFirstPage) {
        currentPage = 0;
      } else {
        if (currentPage >= totalPages) currentPage = totalPages - 1;
        if (currentPage < 0) currentPage = 0;
      }
      
      document.getElementById('pages-container').innerHTML = generatePageHTML(title, subtitle, pagesData[currentPage], currentPage + 1, totalPages);
      
      let exportHTML = '';
      for (let i = 0; i < totalPages; i++) {
        exportHTML += `<div class="export-page" data-page="${i}">${generatePageHTML(title, subtitle, pagesData[i], i + 1, totalPages)}</div>`;
      }
      document.getElementById('export-container').innerHTML = exportHTML;
      
      document.getElementById('page-info').textContent = `üìÑ ÂÖ± ${totalPages} È°µ`;
      document.getElementById('page-display').textContent = `${currentPage + 1} / ${totalPages}`;
      document.getElementById('btn-prev').disabled = currentPage === 0;
      document.getElementById('btn-next').disabled = currentPage === totalPages - 1;
    }
    
    function prevPage() { if (currentPage > 0) { currentPage--; updatePreview(); } }
    function nextPage() { if (currentPage < totalPages - 1) { currentPage++; updatePreview(); } }
    
    function showLoading(show) { document.getElementById('loading').classList.toggle('show', show); }
    
    async function downloadCurrentPage() {
      showLoading(true);
      try {
        const el = document.querySelector(`.export-page[data-page="${currentPage}"] .memo-page`);
        const bgColor = currentTheme === 'dark' ? '#1a1a2e' : '#fefefe';
        const canvas = await html2canvas(el, { width: 1080, height: 1440, scale: 1, useCORS: true, backgroundColor: bgColor });
        const link = document.createElement('a');
        link.download = `${currentPage + 1}.png`;
        link.href = canvas.toDataURL('image/png');
        link.click();
      } catch (e) { alert('‰∏ãËΩΩÂ§±Ë¥•'); console.error(e); }
      showLoading(false);
    }
    
    async function downloadAllPages() {
      if (totalPages === 1) {
        // Âè™Êúâ‰∏ÄÈ°µÁõ¥Êé•‰∏ãËΩΩÂõæÁâá
        return downloadCurrentPage();
      }
      
      showLoading(true);
      try {
        const zip = new JSZip();
        
        for (let i = 0; i < totalPages; i++) {
          const el = document.querySelector(`.export-page[data-page="${i}"] .memo-page`);
          const bgColor = currentTheme === 'dark' ? '#1a1a2e' : '#fefefe';
          const canvas = await html2canvas(el, { width: 1080, height: 1440, scale: 1, useCORS: true, backgroundColor: bgColor });
          
          // Â∞ÜcanvasËΩ¨‰∏∫blob
          const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));
          
          // Ê∑ªÂä†Âà∞zipÔºåÊñá‰ª∂Âêç‰∏∫ 1.png, 2.png, 3.png...
          zip.file(`${i + 1}.png`, blob);
        }
        
        // ÁîüÊàêzipÊñá‰ª∂Âπ∂‰∏ãËΩΩ
        const zipBlob = await zip.generateAsync({ type: 'blob' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(zipBlob);
        link.download = `Â∞èÁ∫¢‰π¶Á¨îËÆ∞_${totalPages}È°µ.zip`;
        link.click();
        URL.revokeObjectURL(link.href);
        
        showToast(`Â∑≤ÊâìÂåÖ ${totalPages} Âº†ÂõæÁâá`);
      } catch (e) { 
        alert('‰∏ãËΩΩÂ§±Ë¥•: ' + e.message); 
        console.error(e); 
      }
      showLoading(false);
    }
    
    // ÂàùÂßãÂåñ
    initTheme();
    updatePreview();
    updateBackupStatus();
    setupImageDrag();
  </script>
</body>
</html>
